$(document).bind(Firefly.Event.UnHandledCommand,function(d,b){if(b.cmd=="create"&&b.type=="Image"){var e=new Firefly.Image(b.src!=void 0?b.src:"photoLib/nav/01.jpg");Firefly.editor.getEditorCanvas().add(e);e.moveTo(b.x,b.y)}});Firefly.ImageScaleMode={Stretch:0,Inside:1,Outside:2};
Firefly.Image=function(d){Firefly.ComponentBase.call(this);var b=this;this.img=$("<img>",{style:"position:absolute;"});this.view.css("overflow","hidden");this.descriptor=new Firefly.ImageDescriptor(this);this.view.attr("ff-autoSize","true");this.setImage=function(a,f){this.img.remove();this.img.css("width","auto");this.img.css("height","auto");this.img.attr("src",a);this.img.get(0).onload=function(){b.img.appendTo(b.view);b.setOriginSize(b.img.width(),b.img.height());b.getAutoSize()?(b.view.outerWidth(b.img.width()),
b.view.outerHeight(b.img.height())):b.setScaleMode(b.getScaleMode());f!=void 0&&f()}};this.setImage(d);this.getOriginSize=function(){var a=this.view.attr("ff-originSize");a!=void 0&&(a=a.split(","),a={width:a[0],height:a[1]});return a};this.setOriginSize=function(a,b){this.view.attr("ff-originSize",[a,b].join(","))};this.getScaleMode=function(){var a=this.view.attr("ff-scaleMode");return a=a==void 0?0:parseInt(a)};this.setScaleMode=function(a){this.view.attr("ff-scaleMode",a);var a=this.view.outerWidth(),
b=this.view.outerHeight();this.resizeTo(a,b)};var e=this.setAutoSize;this.setAutoSize=function(a){a&&(this.view.outerWidth(this.getOriginSize().width),this.view.outerHeight(this.getOriginSize().height),this.img.width(this.getOriginSize().width),this.img.height(this.getOriginSize().height),this.img.css("left",0),this.img.css("top",0));e.call(this,a)};var g=this.resizeTo;this.resizeTo=function(a,b){a=a==void 0?this.view.outerWidth():a;b=b==void 0?this.view.outerHeight():b;if(this.getScaleMode()==Firefly.ImageScaleMode.Stretch)this.img.width(a),
this.img.height(b),this.img.css("left",0),this.img.css("top",0);else if(this.getScaleMode()==Firefly.ImageScaleMode.Inside){var c=a/this.getOriginSize().width<b/this.getOriginSize().height?a/this.getOriginSize().width:b/this.getOriginSize().height;this.img.width(this.getOriginSize().width*c);this.img.height(this.getOriginSize().height*c);var c=(a-this.img.width())*0.5,d=(b-this.img.height())*0.5;this.img.css("left",c);this.img.css("top",d)}else this.getScaleMode()==Firefly.ImageScaleMode.Outside&&
(c=a/this.getOriginSize().width>b/this.getOriginSize().height?a/this.getOriginSize().width:b/this.getOriginSize().height,this.img.width(this.getOriginSize().width*c),this.img.height(this.getOriginSize().height*c),c=(a-this.img.width())*0.5,d=(b-this.img.height())*0.5,this.img.css("left",c),this.img.css("top",d));g.call(this,a,b)};this.clone=function(){var a=new Firefly.Image;a.view=this.view.clone();a.img=a.view.find("img").eq(0);return a};this.toXmlNode=function(){var a=this.view.clone();a.attr("ff-type",
"Image");return a}};Firefly.Image.create=function(d){var b=new Firefly.Image;b.view=d;b.img=b.view.find("img").eq(0);return b};
