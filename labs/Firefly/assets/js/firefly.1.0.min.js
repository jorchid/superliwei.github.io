var Firefly={Event:{UnHandledCommand:"FireflyUnHandledCommandEvent"}};Firefly.init=function(){this.mainLayout=new Firefly.MainLayout("#mainLayout");this.topMenu=new Firefly.TopMenu("#topMenu");var b=$("#mainLayout #centerBox");this.editor=new Firefly.Editor(b);this.resourcePanel=new Firefly.ResourcePanel;this.propertiesPanel=new Firefly.PropertiesPanel;this.historyPanel=new Firefly.HistoryPanel;this.settingWin=new Firefly.SettingWin("#settingWin");this.inputWin=new Firefly.InputWin("#inputWin")};
$(function(){Firefly.init()});function trace(b){console.log(b)};Firefly.File={openFile:function(){var b=this;this.browser(function(a){a.name.split(".").indexOf("ff")!==1?Firefly.Alert.show("\u6587\u4ef6\u683c\u5f0f\u4e0d\u5bf9!"):b.readText(a,function(a){Firefly.editor.checkSource(a)?Firefly.editor.importSource(a):Firefly.Alert.show("\u6587\u4ef6\u6e90\u7801\u9519\u8bef!")})})},exportFile:function(){var b=this;Firefly.inputWin.show({icon:"save icon",title:"\u4fdd\u5b58\u6e90\u6587\u4ef6",placeholder:"\u8f93\u5165\u6587\u4ef6\u540d\u79f0",rightlabel:".ff",value:"firefly-"+
(new Date).getTime(),submitLabel:"\u4fdd\u5b58",onSubmit:function(a){var c=Firefly.editor.exportSource();b.saveText(c,a+".ff")}})},browser:function(b){var a=$("<input type='file'>");a.trigger("click");a.change(function(){var c=a.get(0).files[0];b(c)})},saveData:function(b,a){var c=$("<a>");c.attr("href",b);c.attr("download",a);c.get(0).click()},saveText:function(b,a){this.saveData("data:application/octet-stream;base64,"+Base64.encode(b),a)},readText:function(b,a){$("#loadingMask").dimmer({closable:!1});
$("#loadingMask").find(".ui.text.loader").text("\u6587\u4ef6\u8bfb\u53d6\u4e2d...");$("#loadingMask").dimmer("show");var c=new FileReader;c.onload=function(){$("#loadingMask").dimmer("hide");a(c.result)};c.readAsText(b)}};Firefly.KeyboardManager={};
Firefly.KeyboardManager.init=function(){$(window).keydown(function(b){switch(b.keyCode){case 38:b.preventDefault();!b.ctrlKey&&!b.shiftKey&&Firefly.KeyboardManager.execute("\u2191");break;case 40:b.preventDefault();!b.ctrlKey&&!b.shiftKey&&Firefly.KeyboardManager.execute("\u2193");break;case 37:b.preventDefault();!b.ctrlKey&&!b.shiftKey&&Firefly.KeyboardManager.execute("\u2190");break;case 39:b.preventDefault();!b.ctrlKey&&!b.shiftKey&&Firefly.KeyboardManager.execute("\u2192");break;case 65:b.ctrlKey&&
b.preventDefault();break;case 68:b.ctrlKey&&b.preventDefault();break;case 73:b.ctrlKey&&b.shiftKey&&b.preventDefault();break;case 79:b.ctrlKey&&b.preventDefault();break;case 85:b.ctrlKey&&b.preventDefault();break;case 49:b.ctrlKey&&b.preventDefault();break;case 50:b.ctrlKey&&b.preventDefault();break;case 89:b.ctrlKey&&b.preventDefault();break;case 90:b.ctrlKey&&b.preventDefault()}});$(window).keyup(function(b){switch(b.keyCode){case 46:Firefly.KeyboardManager.execute("Delete");break;case 65:b.ctrlKey&&
Firefly.KeyboardManager.execute("Ctrl+A");break;case 68:b.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+D");break;case 73:b.ctrlKey&&b.shiftKey&&Firefly.KeyboardManager.execute("Ctrl+Shift+I");break;case 79:b.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+O");break;case 85:b.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+U");break;case 49:b.ctrlKey&&b.shiftKey?Firefly.KeyboardManager.execute("Ctrl+Shift+1"):b.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+1");break;case 50:b.ctrlKey&&b.shiftKey?
Firefly.KeyboardManager.execute("Ctrl+Shift+2"):b.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+2");break;case 90:b.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+Z");break;case 89:b.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+Y");break;case 67:b.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+C");break;case 86:b.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+V");break;case 88:b.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+X");break;case 38:b.preventDefault();b.ctrlKey&&b.shiftKey?Firefly.KeyboardManager.execute("Ctrl+Shift+\u2191"):
b.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+\u2191");break;case 40:b.preventDefault();b.ctrlKey&&b.shiftKey?Firefly.KeyboardManager.execute("Ctrl+Shift+\u2193"):b.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+\u2193");break;case 37:b.preventDefault();b.ctrlKey&&b.shiftKey?Firefly.KeyboardManager.execute("Ctrl+Shift+\u2190"):b.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+\u2190");break;case 39:b.preventDefault(),b.ctrlKey&&b.shiftKey?Firefly.KeyboardManager.execute("Ctrl+Shift+\u2192"):b.ctrlKey&&
Firefly.KeyboardManager.execute("Ctrl+\u2192")}})};
Firefly.KeyboardManager.execute=function(b){switch(b){case "Delete":Firefly.HistoryManager.addRemoveSelectedComponentsAction();break;case "Ctrl+Z":Firefly.HistoryManager.undo();break;case "Ctrl+Y":Firefly.HistoryManager.redo();break;case "Ctrl+C":Firefly.Clipboard.copy();break;case "Ctrl+V":Firefly.Clipboard.paste();break;case "Ctrl+X":Firefly.Clipboard.cut();break;case "\u2191":Firefly.HistoryManager.addStepMoveAction("up");break;case "\u2193":Firefly.HistoryManager.addStepMoveAction("down");break;
case "\u2190":Firefly.HistoryManager.addStepMoveAction("left");break;case "\u2192":Firefly.HistoryManager.addStepMoveAction("right");break;case "Ctrl+\u2191":Firefly.HistoryManager.addMoveSelectedComponentLayerAction("up");break;case "Ctrl+\u2193":Firefly.HistoryManager.addMoveSelectedComponentLayerAction("down");break;case "Ctrl+Shift+\u2191":Firefly.HistoryManager.addMoveSelectedComponentLayerAction("top");break;case "Ctrl+Shift+\u2193":Firefly.HistoryManager.addMoveSelectedComponentLayerAction("bottom");
break;case "Ctrl+A":Firefly.HistoryManager.addSelectAllAction();break;case "Ctrl+Shift+I":Firefly.HistoryManager.addInvertSelectAction();break;case "Ctrl+D":Firefly.HistoryManager.addCancelSelectAction();break;case "Ctrl+1":Firefly.topMenu.panelMenuController.getMenu().dropdown("set selected","properties");break;case "Ctrl+2":Firefly.topMenu.panelMenuController.getMenu().dropdown("set selected","history");break;case "Ctrl+Shift+1":Firefly.mainLayout.toggleLeft();break;case "Ctrl+Shift+2":Firefly.mainLayout.toggleRight();
break;case "Ctrl+O":Firefly.File.openFile();break;case "export":Firefly.File.exportFile();break;case "Ctrl+U":Firefly.settingWin.show(0);break;case "showQuickKey":Firefly.settingWin.show(1);break;case "about":Firefly.settingWin.show(2)}};$(function(){Firefly.KeyboardManager.init()});Firefly.HistoryManager={};Firefly.HistoryManager.UPDATE="historyManagerUpdate";Firefly.HistoryManager.maxLen=50;Firefly.HistoryManager.items=[];Firefly.HistoryManager.idx=-1;Firefly.HistoryManager.add=function(b,a,c){for(;this.items.length-1>this.idx;)this.items.pop();b=new Firefly.HistoryItem(b,a,c);this.items.push(b);this.items.length>this.maxLen&&this.items.shift();b.redo();this.idx=this.items.length-1;$(document).trigger(Firefly.HistoryManager.UPDATE)};
Firefly.HistoryManager.addChangeAction=function(b,a,c,e){this.add(b,function(){e(a)},function(){e(c)})};Firefly.HistoryManager.undo=function(){this.idx>-1&&(this.items[this.idx].undo(),this.idx--,$(document).trigger(Firefly.HistoryManager.UPDATE))};Firefly.HistoryManager.redo=function(){this.idx<this.items.length-1&&(this.idx++,this.items[this.idx].redo(),$(document).trigger(Firefly.HistoryManager.UPDATE))};
Firefly.HistoryManager.removeAll=function(){for(;this.items.length>0;)this.items.pop();this.idx=-1;$(document).trigger(Firefly.HistoryManager.UPDATE)};Firefly.HistoryManager.go=function(b){for(b=this.items.indexOf(b);this.idx!=b;)b<this.idx?(this.items[this.idx].undo(),this.idx--):(this.idx++,this.items[this.idx].redo());$(document).trigger(Firefly.HistoryManager.UPDATE)};Firefly.HistoryItem=function(b,a,c){this.type=b;this.undo=a;this.redo=c};
Firefly.HistoryManager.addComponentAction=function(b){var a;this.add("new",function(){var b=Firefly.editor.getEditorCanvas();a=b.components[b.components.length-1];b.remove(a)},function(){a==void 0?Firefly.editor.runCmd(b):Firefly.editor.getEditorCanvas().add(a)})};Firefly.HistoryManager.addSelectAction=function(b,a){Firefly.ArrayUtil.equals(b,a)?Firefly.editor.getEditorCanvas().scaleTool.setTargets(a):this.addChangeAction(a.length>0?"select":"unselect",b,a,function(a){Firefly.editor.getEditorCanvas().scaleTool.setTargets(a)})};
Firefly.HistoryManager.addSelectAllAction=function(){var b=Firefly.editor.getEditorCanvas().components,a=Firefly.editor.getEditorCanvas().scaleTool.targets;b.length>0&&b.length!=a.length&&this.addSelectAction(a.concat(),b.concat())};
Firefly.HistoryManager.addInvertSelectAction=function(){var b=Firefly.editor.getEditorCanvas().components,a=Firefly.editor.getEditorCanvas().scaleTool.targets;if(b.length>0&&b.length-a.length>0){var c=function(){var c=[];$.each(b,function(){a.indexOf(this)==-1&&c.push(this)});return c}();this.addSelectAction(a.concat(),c)}};Firefly.HistoryManager.addCancelSelectAction=function(){var b=Firefly.editor.getEditorCanvas().scaleTool.targets;b.length>0&&this.addSelectAction(b.concat(),[])};
Firefly.HistoryManager.addMoveAction=function(b,a,c){this.addChangeAction("move",a,c,function(a){$.each(b,function(b){this.view.css("left",a[b].left);this.view.css("top",a[b].top);this.descriptor.update()});Firefly.editor.getEditorCanvas().scaleTool.update()})};var lastTargets,firstPos;
Firefly.HistoryManager.addStepMoveAction=function(b){var a=Firefly.editor.getEditorCanvas().scaleTool.targets.concat();if(a.length>0){var c=function(){var b=[];$.each(a,function(){b.push(this.view.position())});return b}(),e=function(){var a=[];$.each(c,function(){var c={};switch(b){case "up":c.left=this.left;c.top=this.top-1;break;case "down":c.left=this.left;c.top=this.top+1;break;case "left":c.left=this.left-1;c.top=this.top;break;case "right":c.left=this.left+1,c.top=this.top}a.push(c)});return a}();
lastTargets!=void 0&&Firefly.ArrayUtil.equals(lastTargets,a)&&this.items[this.items.length-1].type=="move"?(this.items.pop(),this.addMoveAction(a,firstPos,e)):(lastTargets=a,firstPos=c,this.addMoveAction(a,c,e))}};
Firefly.HistoryManager.addRemoveSelectedComponentsAction=function(){var b=Firefly.editor.getEditorCanvas().scaleTool.targets.concat();b.length!=0&&this.add("del",function(){$.each(b,function(){Firefly.editor.getEditorCanvas().add(this)});Firefly.editor.getEditorCanvas().scaleTool.setTargets(b)},function(){$.each(b,function(){Firefly.editor.getEditorCanvas().remove(this)});Firefly.editor.getEditorCanvas().scaleTool.setTargets([])})};
Firefly.HistoryManager.addScaleSelectedComponentsAction=function(b,a){this.addChangeAction("scale",b,a,function(a){Firefly.editor.getEditorCanvas().scaleTool.moveTo(a.x,a.y);Firefly.editor.getEditorCanvas().scaleTool.resizeTo(a.width,a.height);Firefly.editor.getEditorCanvas().scaleTool.update();Firefly.editor.getEditorCanvas().scaleTool.descriptor.update()})};Firefly.HistoryManager.addPropertiesEditAction=function(b,a,c){this.addChangeAction("edit",b,a,c)};
Firefly.HistoryManager.addMoveSelectedComponentLayerAction=function(b){var a=Firefly.editor.getEditorCanvas().scaleTool.targets;a.length==1&&this.addMoveLayerAction(a[0],b)};
Firefly.HistoryManager.addMoveLayerAction=function(b,a){function c(){var a=Firefly.editor.getEditorCanvas().components,c=a.indexOf(b),d=c+1;d<a.length&&Firefly.HistoryManager.add("edit",function(){b.view.insertBefore(a[c].view);a.splice(d,1);a.splice(c,0,b)},function(){b.view.insertAfter(a[d].view);a.splice(c,1);a.splice(d,0,b)})}function e(){var a=Firefly.editor.getEditorCanvas().components,c=a.indexOf(b),d=c-1;d>-1&&Firefly.HistoryManager.add("edit",function(){b.view.insertAfter(a[c].view);a.splice(d,
1);a.splice(c,0,b)},function(){b.view.insertBefore(a[d].view);a.splice(c,1);a.splice(d,0,b)})}function d(){var a=Firefly.editor.getEditorCanvas().components,c=Firefly.editor.getEditorCanvas().contentLayer,d=a.indexOf(b);d!=a.length-1&&Firefly.HistoryManager.add("edit",function(){b.view.insertBefore(a[d].view);a.pop();a.splice(d,0,b)},function(){b.view.appendTo(c);a.splice(d,1);a.push(b)})}function f(){var a=Firefly.editor.getEditorCanvas().components,c=Firefly.editor.getEditorCanvas().contentLayer,
d=a.indexOf(b);d>0&&Firefly.HistoryManager.add("edit",function(){b.view.insertAfter(a[d].view);a.shift();a.splice(d,0,b)},function(){b.view.prependTo(c);a.splice(d,1);a.unshift(b)})}switch(a){case "up":c();break;case "down":e();break;case "top":d();break;case "bottom":f()}};Firefly.Clipboard={};Firefly.Clipboard.targets=[];Firefly.Clipboard.isCut=!1;Firefly.Clipboard.copy=function(){var b=Firefly.editor.getEditorCanvas().scaleTool.targets;if(!Firefly.ArrayUtil.equals(b,this.targets)&&b.length>0){var a=this.targets.concat(),c=this.isCut;Firefly.HistoryManager.add("copy",function(){Firefly.Clipboard.targets=a;Firefly.Clipboard.isCut=c},function(){Firefly.Clipboard.targets=b.concat();Firefly.Clipboard.isCut=!1})}};
Firefly.Clipboard.cut=function(){var b=Firefly.editor.getEditorCanvas().scaleTool.targets;if(b.length>0){var a=this.targets.concat(),c=Firefly.editor.getEditorCanvas().scaleTool.targets.concat(),e=this.isCut;Firefly.HistoryManager.add("cut",function(){$.each(Firefly.Clipboard.targets,function(){Firefly.editor.getEditorCanvas().add(this)});Firefly.Clipboard.targets=a;Firefly.editor.getEditorCanvas().scaleTool.setTargets(c);Firefly.Clipboard.isCut=e},function(){Firefly.Clipboard.targets=b.concat();
$.each(Firefly.Clipboard.targets,function(){Firefly.editor.getEditorCanvas().remove(this)});Firefly.editor.getEditorCanvas().scaleTool.setTargets([]);Firefly.Clipboard.isCut=!0})}};
Firefly.Clipboard.paste=function(){if(this.targets.length>0&&this.isCut){var b=Firefly.Clipboard.targets.concat(),a=Firefly.editor.getEditorCanvas().scaleTool.targets.concat();Firefly.HistoryManager.add("paste",function(){$.each(b,function(){Firefly.editor.getEditorCanvas().remove(this)});Firefly.editor.getEditorCanvas().scaleTool.setTargets(a);Firefly.Clipboard.targets=b;Firefly.Clipboard.isCut=!0},function(){$.each(Firefly.Clipboard.targets,function(){Firefly.editor.getEditorCanvas().add(this)});
Firefly.editor.getEditorCanvas().scaleTool.setTargets(Firefly.Clipboard.targets);Firefly.Clipboard.targets=[];Firefly.Clipboard.isCut=!1})}else if(this.targets.length>0&&!this.isCut){var c=[],e=!1,a=Firefly.editor.getEditorCanvas().scaleTool.targets.concat();Firefly.HistoryManager.add("paste",function(){$.each(c,function(){Firefly.editor.getEditorCanvas().remove(this)});Firefly.editor.getEditorCanvas().scaleTool.setTargets(a)},function(){$.each(Firefly.Clipboard.targets,function(a){e?a=c[a]:(a=this.clone(),
c.push(a));Firefly.editor.getEditorCanvas().add(a)});Firefly.editor.getEditorCanvas().scaleTool.setTargets(c);e=!0})}};Firefly.DragItem=function(b,a){this.view=$("<div class='dragItem'></div>");this.img=$("<img>",{src:b});this.img.appendTo(this.view);a!=void 0&&(this.view.outerWidth(a.width),this.view.outerHeight(a.height),this.img.css("max-width",a.width-10),this.img.css("max-height",a.height-10));this.getSnapshot=function(){var a=$("<div class='dragItemSnapshot'></div>");this.img.clone().appendTo(a);return a};this.setTip=function(a){this.view.attr("data-content",a);this.view.attr("data-variation","mini");this.view.popup({position:"bottom center"})}};Firefly.ColorPicker=function(b,a){var c=this;this.view=a;if(this.view==void 0)this.view=$('<div class="colorPicker"><div class="box"></div></div>');var e=this.view.find(".box");this.view.colpick({flat:!1,layout:"hex",submit:1,onChange:function(a,b){var e;if(c.onChange!=void 0)c.onChange("#"+b)},onSubmit:function(a,b){var g="#"+b;e.css("background-color",g);if(c.onSubmit!=void 0)c.onSubmit(g)},color:b});e.css("background-color",b);this.setColor=function(a){e.css("background-color",a);this.view.colpickSetColor(a)}};Firefly.Dropdown=function(b,a){var c=this;this.view=Firefly.FormViewManager.createDropdownView(b,a);this.dropdown=this.view.find(".ui.dropdown");this.fireChangeEvent=!0;this.dropdown.dropdown({onChange:function(a,b,f){if(c.onChange!=void 0&&c.fireChangeEvent)c.onChange(a,b,f)}});this.setValue=function(a){this.fireChangeEvent=!1;this.dropdown.dropdown("set selected",a.toString());this.fireChangeEvent=!0}};Firefly.EditorCanvas=function(b){var a=this;this.view=$("<div style='position:absolute;'></div>");this.view.outerWidth(960);this.view.outerHeight(540);this.view.appendTo(b);this.view.css("background-color","#FFFFFF");this.components=[];this.contentLayer=$("<div style='position:absolute;'></div>");this.contentLayer.appendTo(this.view);this.overLayer=$("<div style='position:absolute;'></div>");this.overLayer.appendTo(this.view);this.topLayer=$("<div style='position:absolute;'></div>");this.topLayer.appendTo(this.view);
this.scaleTool=new Firefly.ScaleTool;this.scaleTool.view.appendTo(this.overLayer);this.alignManager=new Firefly.AlignManager(this);this.enableAutoAlign=!0;this.descriptor=new Firefly.EditorCanvasDescriptor(this);(function(){var c=new Firefly.SelectBox;c.view.appendTo(a.topLayer);b.mousedown(function(b){function d(a){a.preventDefault();var b=a.clientX-k.x,d=a.clientY-k.y;b>=0?(c.view.offset({left:k.x}),c.view.outerWidth(b)):(c.view.offset({left:a.clientX}),c.view.outerWidth(-b));d>=0?(c.view.offset({top:k.y}),
c.view.outerHeight(d)):(c.view.offset({top:a.clientY}),c.view.outerHeight(-d))}function f(){for(var b=[],e=new Firefly.Rect(c.view.position().left,c.view.position().top,c.view.outerWidth(),c.view.outerHeight()),k=0;k<a.components.length;k++){var n=a.components[k].view.position().left,q=a.components[k].view.position().top,o=a.components[k].view.outerWidth(),s=a.components[k].view.outerHeight(),n=new Firefly.Rect(n,q,o,s);Firefly.Rect.testRectCross(e,n)&&b.push(a.components[k])}Firefly.HistoryManager.addSelectAction(g,
b);$(document).unbind("mousemove",d);$(document).unbind("mouseup",f);c.view.hide()}b.preventDefault();$(document).bind("mousemove",d);$(document).bind("mouseup",f);var g=a.scaleTool.targets.concat();a.scaleTool.setTargets([]);var k={x:b.clientX,y:b.clientY};c.view.show();c.view.outerWidth(0);c.view.outerHeight(0);c.view.offset({left:k.x,top:k.y})})})();this.add=function(b){b.view.appendTo(this.contentLayer);this.components.push(b);b.view.mousedown(function(e){function d(b){b.preventDefault();n||(n=
!0);var c={x:b.clientX-m.client.x,y:b.clientY-m.client.y},b=m.scaleToolPos.x+c.x,c=m.scaleToolPos.y+c.y;if(a.enableAutoAlign)c=a.alignManager.update({x:b,y:c}),b=c.x,c=c.y;a.scaleTool.moveTo(b,c)}function f(){$(document).unbind("mousemove",d);$(document).unbind("mouseup",f);a.enableAutoAlign&&a.alignManager.clear();if(n){var b=a.scaleTool.targets.concat(),c=g();Firefly.HistoryManager.addMoveAction(b,l,c)}}function g(){var b=[];$.each(a.scaleTool.targets,function(){b.push(this.view.position())});return b}
e.preventDefault();e.stopImmediatePropagation();var k=a.scaleTool.targets.concat(),h;if(a.scaleTool.targets.indexOf(b)<0)e.shiftKey?(h=k.concat(),h.push(b)):h=[b],Firefly.HistoryManager.addSelectAction(k,h);else if(e.shiftKey){h=k.concat();e=h.indexOf(b);h.splice(e,1);Firefly.HistoryManager.addSelectAction(k,h);return}$(document).bind("mousemove",d);$(document).bind("mouseup",f);var m={client:{x:e.clientX,y:e.clientY},scaleToolPos:{x:a.scaleTool.view.position().left,y:a.scaleTool.view.position().top}},
l=g(),n=!1})};this.remove=function(a){this.components.splice(this.components.indexOf(a),1);a.view.remove()};this.toXmlNode=function(){var a=$("<div>");a.width(this.descriptor.getWidth());a.height(this.descriptor.getHeight());a.css("background-color",this.descriptor.getColor());a.attr("ff-type","EditorCanvas");return a}};Firefly.Editor=function(b){function a(){var a=e.view.outerWidth()+1E3,f=e.view.outerHeight()+1E3,a=a>b.outerWidth()?a:b.outerWidth(),f=f>b.outerHeight()?f:b.outerHeight();c.outerWidth(a);c.outerHeight(f);a=(a-e.view.outerWidth())*0.5;f=(f-e.view.outerHeight())*0.5;e.view.css("left",a);e.view.css("top",f)}this.view=$("<div style='position:absolute;'></div>");this.view.outerWidth("100%");this.view.outerHeight("100%");this.view.css("overflow","auto");this.view.appendTo(b);var c=$("<div style='position:absolute;'></div>");
c.appendTo(this.view);var e=new Firefly.EditorCanvas(c);this.getEditorCanvas=function(){return e};this.scrollToCenter=function(){this.view.scrollTop((c.outerHeight()-b.outerHeight())*0.5);this.view.scrollLeft((c.outerWidth()-b.outerWidth())*0.5)};this.updateSize=function(){a();this.scrollToCenter()};this.testDragDrop=function(a){return(new Firefly.Rect(b.offset().left,b.offset().top,b.outerWidth(),b.outerHeight())).contain(a)};this.globalToLocalPoint=function(a){return new Firefly.Point(a.x-e.view.offset().left,
a.y-e.view.offset().top)};this.runCmd=function(a){function b(){var c=new Firefly.Image(a.src);e.add(c);c.moveTo(a.x,a.y)}switch(a.cmd){case "create":switch(a.type){case "Image":b();break;default:$(document).trigger(Firefly.Event.UnHandledCommand,a)}}};this.exportSource=function(){var a=$("<div>"),b=e.toXmlNode();b.appendTo(a);$.each(e.components,function(){this.toXmlNode().appendTo(b)});return a.html()};this.checkSource=function(a){var b=!0,c;try{c=$(a);if(c.attr("ff-type")==void 0||c.attr("ff-type")!=
"EditorCanvas")return b=!1;c.children().each(function(){$(this).attr("ff-type")==void 0&&(b=!1)})}catch(e){b=!1}return b};this.importSource=function(a){for(a=$(a);e.components.length>0;)e.remove(e.components[0]);Firefly.HistoryManager.removeAll();e.descriptor.setWidth(a.width());e.descriptor.setHeight(a.height());var b=a.css("background-color"),b=Firefly.Color.getCSSHexColor(b);e.descriptor.setColor(b);Firefly.editor.getEditorCanvas().scaleTool.setTargets([]);a.children().each(function(){var a=$(this).attr("ff-type"),
a=Firefly[a].create($(this));e.add(a)})};$(window).resize(a);a();this.scrollToCenter()};Firefly.ScaleTool=function(){function b(a){this.direction=a;var b={width:10,height:10},d=this,f={"left-up":"nw-resize","right-up":"ne-resize","left-down":"sw-resize","right-down":"se-resize","left-middle":"w-resize","right-middle":"e-resize","up-middle":"n-resize","down-middle":"s-resize"};this.view=$("<div class='controlBtn'><div class='circle'></div>");this.view.css("cursor",f[a]);this.onDrag=function(a,b,c){this.dragStart=a;this.dragMove=b;this.dragEnd=c};this.view.mousedown(function(g){function k(f){function k(){var a=
{width:l.width,height:l.height};a.width=l.width<0?0:l.width;a.height=l.height<0?0:l.height;var a=a.width/a.height<d.rect.width/d.rect.height?a.width/d.rect.width:a.height/d.rect.height,c=d.rect.width<d.rect.height?b.width/d.rect.width:b.height/d.rect.height,a=a<c?c:a;return{width:d.rect.width*a,height:d.rect.height*a}}function g(){var a={width:l.width,height:l.height};a.width=l.width<b.width?b.width:l.width;a.height=l.height<b.height?b.height:l.height;return a}var h={x:f.clientX-m.x,y:f.clientY-m.y},
p,r;switch(a){case "left-up":l.width=d.rect.width-h.x;l.height=d.rect.height-h.y;h=f.shiftKey?k():g();p=d.rect.width-h.width;r=d.rect.height-h.height;break;case "left-down":l.width=d.rect.width-h.x;l.height=d.rect.height+h.y;h=f.shiftKey?k():g();p=d.rect.width-h.width;r=h.height;break;case "right-up":l.width=d.rect.width+h.x;l.height=d.rect.height-h.y;h=f.shiftKey?k():g();p=h.width;r=d.rect.height-h.height;break;case "right-down":l.width=d.rect.width+h.x;l.height=d.rect.height+h.y;h=f.shiftKey?k():
g();p=h.width;r=h.height;break;case "left-middle":l.width=d.rect.width-h.x;h=g();p=d.rect.width-h.width;break;case "right-middle":l.width=d.rect.width+h.x;h=g();p=h.width;break;case "up-middle":l.height=d.rect.height-h.y;h=g();r=d.rect.height-h.height;break;case "down-middle":l.height=d.rect.height+h.y,h=g(),r=h.height}d.view.css("left",p);d.view.css("top",r);d.dragMove!=void 0&&d.dragMove(f)}function h(a){d.view.removeClass("selected");$(document).unbind("mousemove",k);$(document).unbind("mouseup",
h);$(document.body).css("cursor","auto");d.dragEnd!=void 0&&d.dragEnd(a)}g.preventDefault();g.stopImmediatePropagation();d.view.addClass("selected");$(document).bind("mousemove",k);$(document).bind("mouseup",h);$(document.body).css("cursor",f[a]);var m={x:g.clientX,y:g.clientY},l={width:d.rect.width,height:d.rect.height};d.dragStart!=void 0&&d.dragStart(g)});this.setPosForRect=function(b){this.rect=b;var d,e;switch(a){case "left-up":e=d=0;break;case "right-up":d=b.width;e=0;break;case "left-down":d=
0;e=b.height;break;case "right-down":d=b.width;e=b.height;break;case "left-middle":d=0;e=b.height*0.5;break;case "right-middle":d=b.width;e=b.height*0.5;break;case "up-middle":d=b.width*0.5;e=0;break;case "down-middle":d=b.width*0.5,e=b.height}this.view.css("left",d);this.view.css("top",e)}}var a=this;this.targets=[];this.view=$("<div class='scaleTool'></div>");this.box=$("<div class='box'></div>");this.box.appendTo(this.view);this.descriptor=new Firefly.MultipleSelectDescriptor;this.controlBtns=
function(){function c(){n=!1;h=new Firefly.Rect(a.view.position().left,a.view.position().top,a.box.outerWidth(),a.box.outerHeight());l=a.getInitLayouts(h)}function e(){if(!n){n=!0;for(var b=0;b<a.targets.length;b++){var c=a.targets[b];c.getAutoSize()&&(!c.lockWidth||!c.lockHeight)&&c.setAutoSize(!1)}}c=this.view.position().left;b=this.view.position().top;switch(this.direction){case "left-up":a.controlBtns["left-middle"].view.css("left",c);a.controlBtns["left-down"].view.css("left",c);c=(a.controlBtns["right-middle"].view.position().left-
c)*0.5+c;a.controlBtns["up-middle"].view.css("left",c);a.controlBtns["down-middle"].view.css("left",c);var d=(a.controlBtns["down-middle"].view.position().top-b)*0.5+b;a.controlBtns["left-middle"].view.css("top",d);a.controlBtns["right-middle"].view.css("top",d);a.controlBtns["up-middle"].view.css("top",b);a.controlBtns["right-up"].view.css("top",b);break;case "right-up":a.controlBtns["left-up"].view.css("top",b);a.controlBtns["up-middle"].view.css("top",b);a.controlBtns["right-middle"].view.css("left",
c);a.controlBtns["right-down"].view.css("left",c);c*=0.5;d=(a.controlBtns["down-middle"].view.position().top-b)*0.5+b;a.controlBtns["up-middle"].view.css("left",c);a.controlBtns["down-middle"].view.css("left",c);a.controlBtns["left-middle"].view.css("top",d);a.controlBtns["right-middle"].view.css("top",d);break;case "left-down":a.controlBtns["left-up"].view.css("left",c);a.controlBtns["left-middle"].view.css("left",c);a.controlBtns["down-middle"].view.css("top",b);a.controlBtns["right-down"].view.css("top",
b);c=(a.controlBtns["right-middle"].view.position().left-c)*0.5+c;d=b*0.5;a.controlBtns["up-middle"].view.css("left",c);a.controlBtns["down-middle"].view.css("left",c);a.controlBtns["left-middle"].view.css("top",d);a.controlBtns["right-middle"].view.css("top",d);break;case "right-down":a.controlBtns["right-up"].view.css("left",c);a.controlBtns["right-middle"].view.css("left",c);a.controlBtns["left-down"].view.css("top",b);a.controlBtns["down-middle"].view.css("top",b);c*=0.5;d=b*0.5;a.controlBtns["up-middle"].view.css("left",
c);a.controlBtns["down-middle"].view.css("left",c);a.controlBtns["left-middle"].view.css("top",d);a.controlBtns["right-middle"].view.css("top",d);break;case "left-middle":a.controlBtns["left-up"].view.css("left",c);a.controlBtns["left-down"].view.css("left",c);c=(a.controlBtns["right-middle"].view.position().left-c)*0.5+c;a.controlBtns["up-middle"].view.css("left",c);a.controlBtns["down-middle"].view.css("left",c);break;case "right-middle":a.controlBtns["right-up"].view.css("left",c);a.controlBtns["right-down"].view.css("left",
c);c*=0.5;a.controlBtns["up-middle"].view.css("left",c);a.controlBtns["down-middle"].view.css("left",c);break;case "up-middle":a.controlBtns["left-up"].view.css("top",b);a.controlBtns["right-up"].view.css("top",b);d=(a.controlBtns["down-middle"].view.position().top-b)*0.5+b;a.controlBtns["left-middle"].view.css("top",d);a.controlBtns["right-middle"].view.css("top",d);break;case "down-middle":a.controlBtns["left-down"].view.css("top",b),a.controlBtns["right-down"].view.css("top",b),d=b*0.5,a.controlBtns["left-middle"].view.css("top",
d),a.controlBtns["right-middle"].view.css("top",d)}b=new Firefly.Rect(a.controlBtns["left-up"].view.position().left,a.controlBtns["left-up"].view.position().top,a.controlBtns["right-up"].view.position().left-a.controlBtns["left-up"].view.position().left,a.controlBtns["left-down"].view.position().top-a.controlBtns["left-up"].view.position().top);a.box.css("left",b.x);a.box.css("top",b.y);a.box.outerWidth(b.width);a.box.outerHeight(b.height);m=new Firefly.Rect(a.view.position().left+b.x,a.view.position().top+
b.y,b.width,b.height);a.resizeTargets(l,m);a.descriptor.update(m)}function d(){a.view.offset(a.box.offset());a.box.css("left",0);a.box.css("top",0);a.update();n&&Firefly.HistoryManager.addScaleSelectedComponentsAction(h,m)}for(var f={},g=["left-up","right-up","left-down","right-down","left-middle","right-middle","up-middle","down-middle"],k=g.length,h,m,l,n,q=0;q<k;q++){var o=new b(g[q]);f[g[q]]=o;o.view.appendTo(a.view);o.onDrag(c,e,d)}return f}();this.view.hide();this.setTargets=function(a){this.targets=
a;a.length==0?this.view.hide():(this.view.show(),this.update());Firefly.propertiesPanel.setTargets(a)};this.update=function(){if(this.targets.length!=0){var b=this.getRectOfTargets();this.view.css("left",b.x);this.view.css("top",b.y);this.box.outerWidth(b.width);this.box.outerHeight(b.height);(function(){var e={none:[],all:["left-up","right-up","left-down","right-down","left-middle","right-middle","up-middle","down-middle"],width:["left-middle","right-middle"],height:["up-middle","down-middle"]},
d=e.all;if(a.targets.length==1){var f=a.targets[0];if(f.getAutoSize()||f.lockWidth&&f.lockHeight)d=e.none;else if(f.lockWidth&&!f.lockHeight)d=e.height;else if(!f.lockWidth&&f.lockHeight)d=e.width}for(direction in a.controlBtns)e=a.controlBtns[direction],e.setPosForRect(b),d.indexOf(direction)>-1?(e.view.css("pointer-events","auto"),e.view.css("opacity",1)):(e.view.css("pointer-events","none"),e.view.css("opacity",0))})()}};this.getRectOfTargets=function(){var a,b,d,f;f=this.targets[0];a=f.view.position().left;
b=f.view.position().top;d=a+f.view.outerWidth();f=b+f.view.outerHeight();if(this.targets.length>1)for(var g=1;g<this.targets.length;g++){var k=this.targets[g].view.position().left,h=this.targets[g].view.position().top,m=k+this.targets[g].view.outerWidth(),l=h+this.targets[g].view.outerHeight();a=a>k?k:a;b=b>h?h:b;d=d<m?m:d;f=f<l?l:f}return new Firefly.Rect(a,b,d-a,f-b)};this.moveTo=function(a,b){var d={};if(a!=void 0)d.x=a-this.view.position().left,this.view.css("left",a);if(b!=void 0)d.y=b-this.view.position().top,
this.view.css("top",b);for(var f=0;f<this.targets.length;f++){var g,k;a!=void 0&&(g=this.targets[f].view.position().left+d.x);b!=void 0&&(k=this.targets[f].view.position().top+d.y);this.targets[f].moveTo(g,k)}this.descriptor.update()};this.resizeTo=function(a,b){var a=a==void 0?this.box.outerWidth():a,b=b==void 0?this.box.outerHeight():b,d=new Firefly.Rect(this.view.position().left,this.view.position().top,this.box.outerWidth(),this.box.outerHeight()),f=new Firefly.Rect(d.x,d.y,a,b);this.resizeTargets(d,
f);this.box.outerWidth(a);this.box.outerHeight(b)};this.getInitLayouts=function(b){for(var e=[],d=0;d<this.targets.length;d++){var f=a.targets[d];e.push({x:(f.view.position().left-b.x)/b.width,y:(f.view.position().top-b.y)/b.height,w:f.view.outerWidth()/b.width,h:f.view.outerHeight()/b.height,left:f.view.position().left-b.x,right:b.x+b.width-f.view.position().left-f.view.outerWidth(),top:f.view.position().top-b.y,down:b.y+b.height-f.view.position().top-f.view.outerHeight()})}return e};this.resizeTargets=
function(b,e){var d;d=b instanceof Firefly.Rect?this.getInitLayouts(b):b;for(var f=0;f<this.targets.length;f++){var g=a.targets[f],k=d[f],h=e.x+e.width*k.x,m=e.y+e.height*k.y,l=e.width*k.w,n=e.height*k.h;g.lockWidth&&(h=k.left==0?e.x:h,h=k.right==0?e.x+e.width-g.view.outerWidth():h,h=h+g.view.outerWidth()<e.x+e.width?h:e.x+e.width-g.view.outerWidth(),h=h>e.x?h:e.x);g.lockHeight&&(m=k.top==0?e.y:m,m=k.down==0?e.y+e.height-g.view.outerHeight():m,m=m+g.view.outerHeight()<e.y+e.height?m:e.y+e.height-
g.view.outerHeight(),m=m>e.y?m:e.y);g.moveTo(h,m);g.resizeTo(l,n)}}};Firefly.AlignManager=function(b){function a(){e.lineX!=void 0&&e.lineX.remove()}function c(){e.lineY!=void 0&&e.lineY.remove()}var e=this;this.fix=5;this.update=function(d){var f=d.y,g,d=d.x,k=b.scaleTool.box.outerWidth(),h=[d,d+k*0.5,d+k],k=b.view.width(),k=[0,k*0.5,k];for(i=0;i<b.components.length;i++)if(b.scaleTool.targets.indexOf(b.components[i])==-1)var m=b.components[i].view.position().left,l=b.components[i].view.outerWidth(),k=k.concat([m,m+l*0.5,m+l]);for(i=0;i<h.length;i++){for(j=0;j<k.length;j++)if(Math.abs(h[i]-
k[j])<e.fix){g=[i,j];break}if(g!=void 0)break}if(g!=void 0){d=k[g[1]];if(e.lineX==void 0)e.lineX=$("<div style='position:absolute;border-left:dashed 1px #FF0000;width:0px;'></div>");e.lineX.css("height",b.view.height());e.lineX.appendTo(b.overLayer);e.lineX.css("left",d);d=g[0];g=k[g[1]];d!=0&&(d==1?g-=b.scaleTool.box.outerWidth()*0.5:d==2&&(g-=b.scaleTool.box.outerWidth()));d=g}else a();g=d;d=b.scaleTool.box.outerHeight();k=[f,f+d*0.5,f+d];d=b.view.height();d=[0,d*0.5,d];for(i=0;i<b.components.length;i++)if(b.scaleTool.targets.indexOf(b.components[i])==
-1)h=b.components[i].view.position().top,m=b.components[i].view.outerHeight(),d=d.concat([h,h+m*0.5,h+m]);var n;for(i=0;i<k.length;i++){for(j=0;j<d.length;j++)if(Math.abs(k[i]-d[j])<e.fix){n=[i,j];break}if(n!=void 0)break}if(n!=void 0){f=d[n[1]];if(e.lineY==void 0)e.lineY=$("<div style='position:absolute;border-top:dashed 1px #FF0000;height:0px;'></div>");e.lineY.css("width",b.view.width());e.lineY.appendTo(b.overLayer);e.lineY.css("top",f);f=n[0];n=d[n[1]];f!=0&&(f==1?n-=b.scaleTool.box.outerHeight()*
0.5:f==2&&(n-=b.scaleTool.box.outerHeight()));f=n}else c();return{x:g,y:f}};this.clear=function(){a();c()}};Firefly.SelectBox=function(){this.view=$('<div style="position:absolute;border: solid 1px #0000ff;"></div>');this.view.hide()};Firefly.ResourcePanel=function(){function b(a){function b(c){var f=a.getIconUrl(g[c]),m=new Firefly.DragItem(f,a.item);m.view.appendTo(d);m.view.mousedown(function(){function b(a){a.preventDefault();f||(f=!0,h=m.getSnapshot(),h.offset({left:a.clientX,top:a.clientY}),h.appendTo("body"));h!=void 0&&h.offset({left:a.clientX,top:a.clientY})}function d(){h!=void 0&&(a.onSnapshotDrop(g[c],h),h.remove());$(document).unbind("mousemove",b);$(document).unbind("mouseup",d)}e(m);$(document).bind("mousemove",
b);$(document).bind("mouseup",d);var f=!1,h});if(a.onItemCreate!=void 0)a.onItemCreate(g[c],m)}function e(a){f!=void 0&&f.view.removeClass("selected");f=a;a.view.addClass("selected")}var d=a.view,f,g;$.getJSON(a.listUrl,function(d){g=d;for(var d=g.length,e=0;e<d;e++)new b(e);if(a.onItemsCreateComplete!=void 0)a.onItemsCreateComplete()})}new function(){var a={view:$("#componentContainer"),listUrl:"componentLib/list.json",getIconUrl:function(a){return"componentLib/"+a+"/icon.png"},onSnapshotDrop:function(a,
b){var d=new Firefly.Point(b.offset().left,b.offset().top);if(Firefly.editor.testDragDrop(d)){var f={cmd:"create",type:a},d=Firefly.editor.globalToLocalPoint(d);f.x=d.x;f.y=d.y;Firefly.HistoryManager.addComponentAction(f)}},item:{width:50,height:50},onItemCreate:function(a,b){b.view.css("pointer-events","none");b.view.css("opacity",0.5);Firefly.ComponentManager.append(a,function(a){b.view.css("pointer-events","auto");b.view.css("opacity",1);b.setTip(a.desc)})},onItemsCreateComplete:function(){Firefly.ComponentManager.startLoad()}};
b.call(this,a)};new function(){var a={view:$("#photoContainer"),listUrl:"photoLib/list.json",getIconUrl:function(a){return"photoLib/"+a},onSnapshotDrop:function(a,b){var d=new Firefly.Point(b.offset().left,b.offset().top),f="photoLib/"+a;if(Firefly.editor.testDragDrop(d))f={cmd:"create",type:"Image",src:f},d=Firefly.editor.globalToLocalPoint(d),f.x=d.x,f.y=d.y,Firefly.HistoryManager.addComponentAction(f)}};b.call(this,a)}};
Firefly.ComponentManager={loadItems:[],loadComponent:function(b,a){$.getJSON("componentLib/"+b+"/config.json",function(c){if(c.require.length==0)a(c);else{var e=0;$.each(c.require,function(d,f){$.getScript("componentLib/"+b+"/"+f,function(){e++;e==c.require.length&&a(c)})})}})},append:function(b,a){this.loadItems.push({dir:b,onComplete:a})},startLoad:function(b){function a(e){var d=c.loadItems[e];c.loadComponent(d.dir,function(f){d.onComplete(f);e++;e<c.loadItems.length?a(e):b!=void 0&&b()})}var c=
this;a(0)}};Firefly.PropertiesPanel=function(){this.view=$("#propertiesPanel");this.header=this.view.find("#header");this.form=this.view.find(".ui.form");this.layoutPanel=this.view.find("#layoutPanel");this.setTargets=function(b){this.clear();var a=b.length;a==0?Firefly.editor.getEditorCanvas().descriptor.init(this):a==1?b[0].descriptor.init(this):Firefly.editor.getEditorCanvas().scaleTool.descriptor.init(this)};this.clear=function(){this.view.find(".ui.dropdown").dropdown("hide");var b=$(document).find(".colpick.colpick_hex");
b.length>0&&b.each(function(){$(this).data("colpick").clear();$(this).remove()});this.header.text("");this.form.empty();this.layoutPanel.empty()};this.setTargets([])};Firefly.HistoryPanel=function(){function b(){var a=Firefly.HistoryManager.items.length,b=Firefly.HistoryManager.idx;a==0?(e.addClass("disabled"),d.addClass("disabled"),f.addClass("disabled")):(f.removeClass("disabled"),b==a-1?(d.addClass("disabled"),e.removeClass("disabled")):(b==-1?e.addClass("disabled"):e.removeClass("disabled"),d.removeClass("disabled")));g.empty();a=Firefly.HistoryManager.items.length;if(a==0)g.text("\u6ca1\u6709\u4efb\u4f55\u5386\u53f2\u8bb0\u5f55");else for(var b=[],c=Firefly.HistoryManager.idx,
l=0;l<a;l++){var n=new Firefly.HistoryItemView(Firefly.HistoryManager.items[l]);n.view.prependTo(g);b.push(n);l==c&&b[l].view.addClass("active")}}var a=$("#historyPanel"),c=a.find(".ui.tab.segment .menu .item"),e=c.eq(0),d=c.eq(1),f=c.eq(2),g=a.find(".ui.tab.segment .list");b();e.click(function(){Firefly.HistoryManager.undo()});d.click(function(){Firefly.HistoryManager.redo()});f.click(function(){Firefly.HistoryManager.removeAll()});$(document).bind(Firefly.HistoryManager.UPDATE,b);this.getUndoAble=
function(){return!e.hasClass("disabled")};this.getRedoAble=function(){return!d.hasClass("disabled")}};
Firefly.HistoryItemView=function(b){var a={"new":{icon:"add circle icon",label:"\u6dfb\u52a0\u4e86\u7ec4\u4ef6"},del:{icon:"trash icon",label:"\u5220\u9664\u4e86\u7ec4\u4ef6"},select:{icon:"check circle icon",label:"\u9009\u62e9\u4e86\u7ec4\u4ef6"},unselect:{icon:"circle thin icon",label:"\u53d6\u6d88\u4e86\u9009\u62e9"},move:{icon:"move icon",label:"\u79fb\u52a8\u4e86\u7ec4\u4ef6"},scale:{icon:"expand icon",label:"\u7f29\u653e\u4e86\u7ec4\u4ef6"},edit:{icon:"edit icon",label:"\u7f16\u8f91\u4e86\u7ec4\u4ef6"},
copy:{icon:"copy icon",label:"\u590d\u5236\u4e86\u7ec4\u4ef6"},paste:{icon:"paste icon",label:"\u7c98\u8d34\u4e86\u7ec4\u4ef6"},cut:{icon:"cut icon",label:"\u526a\u5207\u4e86\u7ec4\u4ef6"}};this.view=$('<div class="item"></div>');this.icon=$('<i class="'+a[b.type].icon+'"></i>');this.content=$('<div class="content"><div class="header">'+a[b.type].label+"</div></div>");this.icon.appendTo(this.view);this.content.appendTo(this.view);this.view.click(function(){Firefly.HistoryManager.go(b)})};Firefly.ComponentBase=function(){this.view=$('<div style="width:100px; height:100px;position:absolute;"></div>');this.lockHeight=this.lockWidth=!1;this.descriptor=new Firefly.ComponentBaseDescriptor(this);this.moveTo=function(b,a){b!=void 0&&this.view.css("left",b);a!=void 0&&this.view.css("top",a);this.descriptor.update()};this.resizeTo=function(b,a){b!=void 0&&!this.lockWidth&&this.view.outerWidth(b);a!=void 0&&!this.lockHeight&&this.view.outerHeight(a);this.descriptor.update()};this.getAutoSize=
function(){return this.view.attr("ff-autoSize")=="true"?!0:!1};this.setAutoSize=function(b){this.view.attr("ff-autoSize",b?"true":"false");this.descriptor.update()};this.clone=function(){var b=new Firefly.ComponentBase;b.view=this.view.clone();return b};this.toXmlNode=function(){var b=this.view.clone();b.attr("ff-type","ComponentBase");return b}};Firefly.ComponentBase.create=function(b){var a=new Firefly.ComponentBase;a.view=b;return a};Firefly.ImageScaleMode={Stretch:0,Inside:1,Outside:2};
Firefly.Image=function(b){Firefly.ComponentBase.call(this);var a=this;this.img=$("<img>",{src:b,style:"position:absolute;"});this.view.css("overflow","hidden");this.descriptor=new Firefly.ImageDescriptor(this);this.view.attr("ff-autoSize","true");this.img.get(0).onload=function(){a.img.appendTo(a.view);a.setOriginSize(a.img.width(),a.img.height());a.view.outerWidth(a.img.width());a.view.outerHeight(a.img.height())};this.getOriginSize=function(){var a=this.view.attr("ff-originSize");a!=void 0&&(a=
a.split(","),a={width:a[0],height:a[1]});return a};this.setOriginSize=function(a,b){this.view.attr("ff-originSize",[a,b].join(","))};this.getScaleMode=function(){var a=this.view.attr("ff-scaleMode");return a=a==void 0?0:parseInt(a)};this.setScaleMode=function(a){this.view.attr("ff-scaleMode",a);var a=this.view.outerWidth(),b=this.view.outerHeight();this.resizeTo(a,b)};var c=this.setAutoSize;this.setAutoSize=function(a){a&&(this.view.width(this.getOriginSize().width),this.view.height(this.getOriginSize().height),
this.img.width(this.getOriginSize().width),this.img.height(this.getOriginSize().height),this.img.css("left",0),this.img.css("top",0));c.call(this,a)};var e=this.resizeTo;this.resizeTo=function(a,b){a=a==void 0?this.view.outerWidth():a;b=b==void 0?this.view.outerHeight():b;if(this.getScaleMode()==Firefly.ImageScaleMode.Stretch)this.img.width(a),this.img.height(b),this.img.css("left",0),this.img.css("top",0);else if(this.getScaleMode()==Firefly.ImageScaleMode.Inside){var c=a/this.getOriginSize().width<
b/this.getOriginSize().height?a/this.getOriginSize().width:b/this.getOriginSize().height;this.img.width(this.getOriginSize().width*c);this.img.height(this.getOriginSize().height*c);var c=(a-this.img.width())*0.5,k=(b-this.img.height())*0.5;this.img.css("left",c);this.img.css("top",k)}else this.getScaleMode()==Firefly.ImageScaleMode.Outside&&(c=a/this.getOriginSize().width>b/this.getOriginSize().height?a/this.getOriginSize().width:b/this.getOriginSize().height,this.img.width(this.getOriginSize().width*
c),this.img.height(this.getOriginSize().height*c),c=(a-this.img.width())*0.5,k=(b-this.img.height())*0.5,this.img.css("left",c),this.img.css("top",k));e.call(this,a,b)};this.clone=function(){var a=new Firefly.Image;a.view=this.view.clone();a.img=a.view.find("img").eq(0);return a};this.toXmlNode=function(){var a=this.view.clone();a.attr("ff-type","Image");return a}};Firefly.Image.create=function(b){var a=new Firefly.Image;a.view=b;a.img=a.view.find("img").eq(0);return a};Firefly.TopMenu=function(b){function a(){$.each(d,function(){this.update()})}function c(a){function b(){if(d!="")Firefly.KeyboardManager.execute(d);else switch(c){case "\u5bfc\u51fa":Firefly.KeyboardManager.execute("export");break;case "\u952e\u76d8\u5feb\u6377\u952e":Firefly.KeyboardManager.execute("showQuickKey");break;case "\u5173\u4e8eFirefly":Firefly.KeyboardManager.execute("about")}}var c=a.find("span.text").eq(0).text();a.find(".item").length==0&&a.click(b);var d=a.find("span.description").text();
this.update=function(){var a=!0;switch(c){case "\u64a4\u6d88":a=Firefly.historyPanel.getUndoAble();break;case "\u91cd\u505a":a=Firefly.historyPanel.getRedoAble();break;case "\u5220\u9664":a=Firefly.editor.getEditorCanvas().scaleTool.targets.length>0;break;case "\u590d\u5236":a=Firefly.editor.getEditorCanvas().scaleTool.targets.length>0;break;case "\u526a\u5207":a=Firefly.editor.getEditorCanvas().scaleTool.targets.length>0;break;case "\u7c98\u8d34":a=Firefly.Clipboard.targets.length>0;break;case "\u79fb\u52a8":a=
Firefly.editor.getEditorCanvas().scaleTool.targets.length>0;break;case "\u7f6e\u9876":a=Firefly.editor.getEditorCanvas().scaleTool.targets.length==1;break;case "\u7f6e\u5e95":a=Firefly.editor.getEditorCanvas().scaleTool.targets.length==1;break;case "\u4e0a\u79fb\u4e00\u5c42":a=Firefly.editor.getEditorCanvas().scaleTool.targets.length==1;break;case "\u4e0b\u79fb\u4e00\u5c42":a=Firefly.editor.getEditorCanvas().scaleTool.targets.length==1;break;case "\u5168\u9009":a=Firefly.editor.getEditorCanvas().components.length>
0&&Firefly.editor.getEditorCanvas().components.length!=Firefly.editor.getEditorCanvas().scaleTool.targets.length;break;case "\u53cd\u9009":a=Firefly.editor.getEditorCanvas().components.length>0&&Firefly.editor.getEditorCanvas().components.length-Firefly.editor.getEditorCanvas().scaleTool.targets.length>0;break;case "\u53d6\u6d88\u9009\u62e9":a=Firefly.editor.getEditorCanvas().scaleTool.targets.length>0;break;case "\u5c5e\u6027\u9762\u677f":a=Firefly.topMenu.panelMenuController.getSelectedValue()!=
"properties";break;case "\u5386\u53f2\u8bb0\u5f55":a=Firefly.topMenu.panelMenuController.getSelectedValue()!="history"}this.setEnabled(a)};this.setEnabled=function(b){b?a.removeClass("disabled"):a.addClass("disabled")}}this.view=$(b);b=this.view.find(".ui.dropdown:not(.right.menu .ui.dropdown)");b.dropdown({on:"hover",onShow:function(){a()}});var e=b.find(".item"),d=[];e.each(function(){d.push(new c($(this)))});this.panelMenuController=new function(a){var b=this,c,d={properties:$("#propertiesPanel"),
history:$("#historyPanel")};$.each(d,function(){$(this).css("display","none")});this.selectValue=function(a){c!=void 0&&d[c].css("display","none");c=a;d[c].css("display","block")};this.getSelectedValue=function(){return c};this.getMenu=function(){return a};this.selectValue("properties");a.dropdown("set selected",c);a.dropdown({onChange:function(a){b.selectValue(a)}})}(this.view.find(".right.menu .ui.dropdown").eq(0));this.getItems=function(){return e}};Firefly.SettingWin=function(b){function a(a,b){this.setDisplay=function(c){a.css("display",c?"block":"none");b.css("display",c?"block":"none")}}var c=this;this.view=$(b);var e=this.view.find(".ui.menu .item"),b=this.view.find(".content").eq(0).children(),d=this.view.find(".actions").eq(0).children(),f=[new function(b,c){a.call(this,b,c);var d=this,e=b.find(".ui.checkbox"),f=b.find("input").eq(1),g=b.find("input").eq(2),o=c.find("button").eq(0);this.getEnableAlign=function(){return Firefly.editor.getEditorCanvas().enableAutoAlign};
this.setEnableAlign=function(a){Firefly.editor.getEditorCanvas().enableAutoAlign=a};this.getDis=function(){return Firefly.editor.getEditorCanvas().alignManager.fix};this.setDis=function(a){Firefly.editor.getEditorCanvas().alignManager.fix=a};this.getMaxHistory=function(){return Firefly.HistoryManager.maxLen};this.setMaxHistory=function(a){Firefly.HistoryManager.maxLen=a};this.initValues=function(){var a=this.getEnableAlign();e.checkbox(a?"set checked":"set unchecked");f.parent()[a?"removeClass":"addClass"]("disabled");
f.val(this.getDis());g.val(this.getMaxHistory())};this.initValues();e.checkbox({onChange:function(){var a=e.checkbox("is checked");f.parent()[a?"removeClass":"addClass"]("disabled")}});o.click(function(){var a=e.checkbox("is checked");d.setEnableAlign(a);d.setDis(f.val());d.setMaxHistory(g.val())})}(b.eq(0),d.eq(0)),new function(b,c){a.call(this,b,c);var d='<table class="ui celled table">';d+=" <thead><tr>";d+="  <th>\u5feb\u6377\u952e</th>";d+="  <th>\u8bf4\u660e</th>";d+=" </tr></thead>";d+=" <tbody>";
Firefly.topMenu.getItems().each(function(){if($(this).find(".item").length==0){var a=$(this).find("span.text").text(),b=$(this).find("span.description").text();b!=""&&(d+="<tr><td>"+b+"</td><td>"+a+"</td></tr>")}});d+=" </tbody>";d+="</table>";$(d).appendTo(b)}(b.eq(1),d.eq(1)),new function(b,c){a.call(this,b,c);var d=this,e=$("<audio>",{src:"assets/sounds/m01.m4a",loop:!0}),f=b.find(".icon.music");f.addClass("red");f.click(function(){f.toggleClass("red");f.hasClass("red")?d.playMusic():d.stopMusic()});
var g=this.setDisplay;this.setDisplay=function(a){g.call(this,a);b.parent().css("background-color",a?"#000000":"#ffffff");a?this.playMusic():this.stopMusic()};this.playMusic=function(){f.hasClass("red")&&e.get(0).play()};this.stopMusic=function(){e.get(0).pause();e.get(0).currentTime=0};var o='<div style="color:#999999;text-align: center;">'+Base64.decode("Qmxhbms=")+"</div>";o+='<div style="color:#999999;text-align: center;">'+Base64.decode("aGVyb2JsYW5rQGdtYWlsLmNvbQ==")+"</div>";$(o).appendTo(b)}(b.eq(2),
d.eq(2))],g=-1;e.each(function(a){$(this).click(function(){c.selectTabIdx(a)})});this.view.modal({onHide:function(){f[2].stopMusic()}});this.show=function(a){f[0].initValues();this.selectTabIdx(a);this.view.modal("show")};this.selectTabIdx=function(a){g>-1&&(e.eq(g).removeClass("active blue"),f[g].setDisplay(!1));e.eq(a).addClass("active blue");g=a;f[a].setDisplay(!0);this.view.modal("refresh")}};Firefly.Alert=function(){var b={},a=$("<div class='ui small modal'>");$("<div class='header'><i class='warning circle icon'></i><label>\u63d0\u793a</label></div>").appendTo(a);var c=$("<div class='content'>");c.appendTo(a);$("<div class='actions'>").appendTo(a);b.show=function(b){c.text(b);a.modal("show")};return b}();Firefly.InputWin=function(b){var a=$(b),c=a.find(".header i").eq(0),e=a.find(".header label").eq(0),d=a.find("input").eq(0),f=a.find(".right.labeled .label").eq(0),g=a.find(".actions button").eq(0),k;g.click(function(){g.addClass("disabled");a.modal("hide");k!=void 0&&k(d.val())});this.setOption=function(a){c.attr("class",a.icon);e.text(a.title);d.attr("placeholder",a.placeholder);f.text(a.rightlabel);g.text(a.submitLabel);d.val(a.value);k=a.onSubmit};this.show=function(b){this.setOption(b);g.removeClass("disabled");
a.modal("show")}};Firefly.EditorCanvasDescriptor=function(b){var a=this;this.title="\u753b\u5e03";this.initComplete=!1;this.init=function(a){this.createChildren(a);this.initComplete=!0;this.update()};this.createChildren=function(b){b.header.text(this.title);var b=b.form,e=Firefly.FormViewManager.createSizeView();e.appendTo(b);Firefly.FormViewManager.createHline().appendTo(b);var d=Firefly.FormViewManager.createColorPickerView("\u80cc\u666f\u989c\u8272");d.appendTo(b);this.colorPicker=new Firefly.ColorPicker(this.getColor(),
d.find(".colorPicker"));b=e.find("input");this.widthInput=b.eq(0);this.heightInput=b.eq(1);this.colorPicker.onSubmit=function(b){var c=a.getColor();Firefly.HistoryManager.addPropertiesEditAction(c,b,function(b){a.setColor(b);a.colorPicker.setColor(b)})};this.widthInput.change(function(){var b=a.getWidth(),c=a.widthInput.val();Firefly.HistoryManager.addPropertiesEditAction(b,c,function(b){a.setWidth(b);a.widthInput.val(b)})});this.heightInput.change(function(){var b=a.getHeight(),c=a.heightInput.val();
Firefly.HistoryManager.addPropertiesEditAction(b,c,function(b){a.setHeight(b);a.heightInput.val(b)})})};this.update=function(){this.initComplete&&(this.widthInput.val(this.getWidth()),this.heightInput.val(this.getHeight()))};this.getWidth=function(){return b.view.outerWidth()};this.setWidth=function(a){a=parseInt(a);b.view.outerWidth(a);Firefly.editor.updateSize()};this.getHeight=function(){return b.view.outerHeight()};this.setHeight=function(a){a=parseInt(a);b.view.outerHeight(a);Firefly.editor.updateSize()};
this.getColor=function(){var a=b.view.css("background-color");return Firefly.Color.getCSSHexColor(a)};this.setColor=function(a){b.view.css("background-color",a)}};Firefly.ComponentBaseDescriptor=function(b){var a=this;this.title="\u57fa\u672c\u7ec4\u4ef6";this.initComplete=!1;this.init=function(a){this.createChildren(a);this.initComplete=!0;this.update()};this.createChildren=function(c){c.header.text(this.title);var e=c.form,d=Firefly.FormViewManager.createPositionView();d.appendTo(e);var f=Firefly.FormViewManager.createSizeView();f.appendTo(e);Firefly.FormViewManager.createHline().appendTo(e);var g=Firefly.FormViewManager.createCheckBoxView("\u81ea\u52a8\u5927\u5c0f");
g.appendTo(e);e=d.find("input");this.xInput=e.eq(0);this.yInput=e.eq(1);f=f.find("input");this.widthInput=f.eq(0);this.heightInput=f.eq(1);this.autoSizeCheckBox=g.find(".ui.checkbox").eq(0);b.lockWidth&&b.lockHeight&&g.addClass("disabled");this.xInput.change(function(){var b=a.getX(),c=a.xInput.val();Firefly.HistoryManager.addPropertiesEditAction(b,c,function(b){a.setX(b);a.xInput.val(b)})});this.yInput.change(function(){var b=a.getY(),c=a.yInput.val();Firefly.HistoryManager.addPropertiesEditAction(b,
c,function(b){a.setY(b);a.yInput.val(b)})});this.widthInput.change(function(){var b=a.getWidth(),c=a.widthInput.val();Firefly.HistoryManager.addPropertiesEditAction(b,c,function(b){a.setWidth(b);a.widthInput.val(b)})});this.heightInput.change(function(){var b=a.getHeight(),c=a.heightInput.val();Firefly.HistoryManager.addPropertiesEditAction(b,c,function(b){a.setHeight(b);a.heightInput.val(b)})});this.autoSizeCheckBox.checkbox({onChange:function(){var b=a.getAutoSize(),c=a.autoSizeCheckBox.checkbox("is checked");
Firefly.HistoryManager.addPropertiesEditAction(b,c,function(b){a.setAutoSize(b);a.autoSizeCheckBox.checkbox(b?"set checked":"set unchecked")})}});Firefly.FormViewManager.createHeaderView("\u53e0\u653e\u987a\u5e8f").appendTo(c.layoutPanel);g=Firefly.FormViewManager.createLayoutView();g.appendTo(c.layoutPanel);c=g.find("button");c.popup();c.each(function(b){$(this).click(function(){switch(b){case 0:a.goTopLayer();break;case 1:a.goBottomLayer();break;case 2:a.goUpLayer();break;case 3:a.goDownLayer()}})})};
this.update=function(){if(this.initComplete){this.xInput.val(this.getX());this.yInput.val(this.getY());this.widthInput.val(this.getWidth());this.heightInput.val(this.getHeight());var a=this.getAutoSize();this.autoSizeCheckBox.checkbox(a?"set checked":"set unchecked");this.widthInput.parent()[a?"addClass":"removeClass"]("disabled");this.heightInput.parent()[a?"addClass":"removeClass"]("disabled");b.lockWidth&&this.widthInput.parent().addClass("disabled");b.lockHeight&&this.heightInput.parent().addClass("disabled")}};
this.getX=function(){return b.view.position().left};this.setX=function(a){a=parseInt(a);b.moveTo(a);Firefly.editor.getEditorCanvas().scaleTool.update()};this.getY=function(){return b.view.position().top};this.setY=function(a){a=parseInt(a);b.moveTo(void 0,a);Firefly.editor.getEditorCanvas().scaleTool.update()};this.getWidth=function(){return b.view.outerWidth()};this.setWidth=function(a){a=parseInt(a);b.resizeTo(a);Firefly.editor.getEditorCanvas().scaleTool.update()};this.getHeight=function(){return b.view.outerHeight()};
this.setHeight=function(a){a=parseInt(a);b.resizeTo(void 0,a);Firefly.editor.getEditorCanvas().scaleTool.update()};this.getAutoSize=function(){return b.getAutoSize()};this.setAutoSize=function(a){b.setAutoSize(a);Firefly.editor.getEditorCanvas().scaleTool.update()};this.goTopLayer=function(){Firefly.HistoryManager.addMoveLayerAction(b,"top")};this.goBottomLayer=function(){Firefly.HistoryManager.addMoveLayerAction(b,"bottom")};this.goUpLayer=function(){Firefly.HistoryManager.addMoveLayerAction(b,"up")};
this.goDownLayer=function(){Firefly.HistoryManager.addMoveLayerAction(b,"down")}};Firefly.MultipleSelectDescriptor=function(){var b=this;this.title="\u9009\u62e9\u591a\u4e2a";this.initComplete=!1;this.init=function(a){this.createChildren(a);this.initComplete=!0;this.update()};this.createChildren=function(a){a.header.text(this.title);var c=a.form,e=Firefly.FormViewManager.createPositionView();e.appendTo(c);a=Firefly.FormViewManager.createSizeView();a.appendTo(c);c=e.find("input");this.xInput=c.eq(0);this.yInput=c.eq(1);a=a.find("input");this.widthInput=a.eq(0);this.heightInput=
a.eq(1);this.xInput.change(function(){var a=b.getX(),c=b.xInput.val();Firefly.HistoryManager.addPropertiesEditAction(a,c,function(a){b.setX(a);b.xInput.val(a)})});this.yInput.change(function(){var a=b.getY(),c=b.yInput.val();Firefly.HistoryManager.addPropertiesEditAction(a,c,function(a){b.setY(a);b.yInput.val(a)})});this.widthInput.change(function(){var a=b.getWidth(),c=b.widthInput.val();Firefly.HistoryManager.addPropertiesEditAction(a,c,function(a){b.setWidth(a);b.widthInput.val(a)})});this.heightInput.change(function(){var a=
b.getHeight(),c=b.heightInput.val();Firefly.HistoryManager.addPropertiesEditAction(a,c,function(a){b.setHeight(a);b.heightInput.val(a)})})};this.update=function(a){this.initComplete&&(this.xInput.val(a==void 0?this.getX():a.x),this.yInput.val(a==void 0?this.getY():a.y),this.widthInput.val(a==void 0?this.getWidth():a.width),this.heightInput.val(a==void 0?this.getHeight():a.height))};this.getX=function(){return Firefly.editor.getEditorCanvas().scaleTool.view.position().left};this.setX=function(a){a=
parseInt(a);Firefly.editor.getEditorCanvas().scaleTool.moveTo(a)};this.getY=function(){return Firefly.editor.getEditorCanvas().scaleTool.view.position().top};this.setY=function(a){a=parseInt(a);Firefly.editor.getEditorCanvas().scaleTool.moveTo(void 0,a)};this.getWidth=function(){return Firefly.editor.getEditorCanvas().scaleTool.box.outerWidth()};this.setWidth=function(a){var a=parseInt(a),b=Firefly.editor.getEditorCanvas().scaleTool;b.resizeTo(a);b.update()};this.getHeight=function(){return Firefly.editor.getEditorCanvas().scaleTool.box.outerHeight()};
this.setHeight=function(a){var a=parseInt(a),b=Firefly.editor.getEditorCanvas().scaleTool;b.resizeTo(void 0,a);b.update()}};Firefly.ImageDescriptor=function(b){var a=this;Firefly.ComponentBaseDescriptor.call(this,b);this.title="\u56fe\u7247";var c=this.createChildren;this.createChildren=function(b){c.call(this,b);this.scaleModeDropdown=new Firefly.Dropdown("\u7f29\u653e\u6a21\u5f0f",[{value:0,label:"\u62c9\u4f38"},{value:1,label:"\u5185\u9002\u5e94"},{value:2,label:"\u5916\u9002\u5e94"}]);this.scaleModeDropdown.view.appendTo(b.form);this.scaleModeDropdown.setValue(this.getScaleMode());this.scaleModeDropdown.onChange=function(b){var c=
a.getScaleMode();Firefly.HistoryManager.addPropertiesEditAction(c,b,function(b){a.setScaleMode(b);a.scaleModeDropdown.setValue(b)})}};this.getScaleMode=function(){return b.getScaleMode()};this.setScaleMode=function(a){b.setScaleMode(a)}};Firefly.FormViewManager={};Firefly.FormViewManager.createPositionView=function(){return $('<div class="inline fields">\t<div class="eight wide field">\t\t<label>X</label>\t\t<input type="text" placeholder="">   </div>   <div class="eight wide field">\t\t<label>Y</label>\t\t<input type="text" placeholder="">\t</div></div>')};Firefly.FormViewManager.createSizeView=function(){return $('<div class="inline fields">\t<div class="eight wide field">\t\t<label>\u5bbd</label>\t\t<input type="text" placeholder="">   </div>   <div class="eight wide field">\t\t<label>\u9ad8</label>\t\t<input type="text" placeholder="">\t</div></div>')};
Firefly.FormViewManager.createHline=function(){return $('<div class="ui divider"></div>')};Firefly.FormViewManager.createCheckBoxView=function(b){return $('<div class="inline fields">\t<div class="five wide field">\t\t<label>'+b+'</label>\t</div>\t<div class="eleven wide field">\t\t<div class="ui checkbox">\t\t\t<input type="checkbox">\t\t\t<label></label>\t\t</div>\t</div></div>')};
Firefly.FormViewManager.createDropdownView=function(b,a){for(var c=$('<div class="inline fields">\t<div class="five wide field">\t\t<label>'+b+'</label>\t</div>\t<div class="eleven wide field">\t\t<div class="ui selection dropdown">\t\t\t<i class="dropdown icon"></i>\t\t\t<div class="default text"></div>\t\t\t<div class="menu">\t\t\t</div>\t\t</div>\t</div></div>'),e=c.find(".menu"),d=a.length,f=0;f<d;f++)$('<div class="item" data-value="'+a[f].value+'">'+a[f].label+"</div>").appendTo(e);return c};
Firefly.FormViewManager.createHeaderView=function(b){return $('<div class="ui small header">'+b+"</div>")};Firefly.FormViewManager.createLayoutView=function(){return $('<div class="ui basic buttons">\t<button class="ui icon button" data-content="\u7f6e\u9876"><i class="arrow circle up icon"></i></button>\t<button class="ui icon button" data-content="\u7f6e\u5e95"><i class="arrow circle down icon"></i></button>\t<button class="ui icon button" data-content="\u4e0a\u79fb\u4e00\u5c42"><i class="arrow up icon"></i></button>\t<button class="ui icon button" data-content="\u4e0b\u79fb\u4e00\u5c42"><i class="arrow down icon"></i></button></div>')};
Firefly.FormViewManager.createColorPickerView=function(b){return $('<div class="inline fields">\t<div class="five wide field">\t\t<label>'+b+'</label>\t</div>\t<div class="eleven wide field">\t\t<div class="colorPicker">\t\t\t<div class="box"></div>\t\t</div>\t</div></div>')};Firefly.FormViewManager.createTextInputView=function(b){return $('<div class="inline fields">\t<div class="five wide field">\t\t<label>'+b+'</label>\t</div>\t<div class="eleven wide field">\t\t<input type="text" placeholder="">\t</div></div>')};
Firefly.FormViewManager.createTextInputWithRightLabelView=function(b,a){return $('<div class="inline fields">\t<div class="five wide field">\t\t<label>'+b+'</label>\t</div>\t<div class="eleven wide field">\t\t<div class="ui right labeled input">\t\t\t<input type="text" placeholder="">\t\t\t<div class="ui basic label">'+a+"</div>\t\t</div>\t</div></div>")};Firefly.FormViewManager.createTextAreaView=function(b){return $('<div class="field">\t<label>'+b+'</label>\t<textarea style="margin-top: 0px; margin-bottom: 0px; height: 148px;"></textarea></div>')};
Firefly.FormViewManager.createFontStyleView=function(b){return $('<div class="inline fields">\t<div class="five wide field">\t\t<label>'+b+'</label>\t</div>\t<div class="eleven wide field">\t\t<div class="ui icon basic buttons">\t\t\t<button class="ui button"><i class="bold icon"></i></button>\t\t\t<button class="ui button"><i class="italic icon"></i></button>\t\t\t<button class="ui button"><i class="underline icon"></i></button>\t\t\t<button class="ui button"><i class="strikethrough icon"></i></button>\t\t</div>\t</div></div>')};
Firefly.FormViewManager.createTextHAlignView=function(b){return $('<div class="inline fields">\t<div class="five wide field">\t\t<label>'+b+'</label>\t</div>\t<div class="eleven wide field">\t\t<div class="ui icon basic buttons">\t\t\t<button class="ui button"><i class="align left icon"></i></button>\t\t\t<button class="ui button"><i class="align center icon"></i></button>\t\t\t<button class="ui button"><i class="align right icon"></i></button>\t\t</div>\t</div></div>')};Firefly.Rect=function(b,a,c,e){this.x=b;this.y=a;this.width=c;this.height=e;this.contain=function(a){return a.x>=this.x&&a.x<=this.x+this.width&&a.y>=this.y&&a.y<=this.y+this.height}};Firefly.Rect.testRectCross=function(b,a){var c,e,d,f;c=b.x+b.width/2;e=b.y+b.height/2;d=a.x+a.width/2;f=a.y+a.height/2;return Math.abs(c-d)<=b.width/2+a.width/2&&Math.abs(e-f)<=b.height/2+a.height/2};Firefly.Point=function(b,a){this.x=b;this.y=a};Firefly.Color={};Firefly.Color.randomColor=function(){var b=Math.floor(Math.random()*16777215).toString(16);return b.length==6?"#"+b:Firefly.Color.randomColor()};Firefly.Color.getCSSHexColor=function(b){if(b.indexOf("rgb")>-1){var a=b,a=b.indexOf("rgba")>-1?a.substr(5,a.length-6):a.substr(4,a.length-5),b=a.split(","),b={r:parseInt(b[0]),g:parseInt(b[1]),b:parseInt(b[2])};return"#"+$.colpick.rgbToHex(b)}else return b};Firefly.ArrayUtil={};Firefly.ArrayUtil.equals=function(b,a){var c=!0;if(b.length!=a.length)c=!1;else for(var e=b.length,d=0;d<e;d++)if(b[d]!==a[d]){c=!1;break}return c};Firefly.MainLayout=function(b){function a(){e.outerWidth(l);f.outerWidth(n);var a=$(window).width()-l-n-g.outerWidth()-k.outerWidth();d.outerWidth(a);var b=$(window).height()-$("#topMenu").outerHeight();e.outerHeight(b);f.outerHeight(b);d.outerHeight(b);d.css("left",l+g.outerWidth());f.css("left",l+a+g.outerWidth()+k.outerWidth());g.outerHeight(b);k.outerHeight(b);g.css("left",l);k.css("left",l+a+g.outerWidth());a=b-c.view.find(".menu").outerHeight()-10;q.outerHeight(a);o.outerHeight(a-s.outerHeight());
p.outerHeight(a)}var c=this;this.view=$(b);var e=this.view.find("#leftBox"),d=this.view.find("#centerBox"),f=this.view.find("#rightBox"),b=this.view.find(".vDivide"),g=b.eq(0),k=b.eq(1),h=g.find(".handle"),m=k.find(".handle"),l=322,n=320;h.click(function(){l=l==322?0:322;a()});m.click(function(){n=n==320?0:320;a()});e.css("position","absolute");d.css("position","absolute");f.css("position","absolute");this.view.find(".menu .item").tab();this.view.find(".segment").css("overflow","auto");var q=this.view.find("#resourcePanel .segment");
q.css("padding",5);var o=this.view.find("#propertiesPanel .segment"),s=this.view.find("#propertiesPanel #header"),p=this.view.find("#historyPanel .segment");p.css("padding",5);$(window).resize(a);a();this.toggleLeft=function(){h.trigger("click")};this.toggleRight=function(){m.trigger("click")}};
