var Firefly={Event:{UnHandledCommand:"FireflyUnHandledCommandEvent"}};
Firefly.init=function(){this.mainLayout=new Firefly.MainLayout("#mainLayout");this.topMenu=new Firefly.TopMenu("#topMenu");var a=$("#mainLayout #centerBox");this.editor=new Firefly.Editor(a);this.resourcePanel=new Firefly.ResourcePanel;this.propertiesPanel=new Firefly.PropertiesPanel;this.historyPanel=new Firefly.HistoryPanel;this.settingWin=new Firefly.SettingWin("#settingWin");this.openWin=new Firefly.OpenWin("#openWin");this.exportWin=new Firefly.ExportWin("#exportWin")};$(function(){Firefly.init()});function trace(a){console.log(a)};Firefly.KeyboardManager={};
Firefly.KeyboardManager.init=function(){$(window).keydown(function(a){switch(a.keyCode){case 38:a.preventDefault();!a.ctrlKey&&!a.shiftKey&&Firefly.KeyboardManager.execute("\u2191");break;case 40:a.preventDefault();!a.ctrlKey&&!a.shiftKey&&Firefly.KeyboardManager.execute("\u2193");break;case 37:a.preventDefault();!a.ctrlKey&&!a.shiftKey&&Firefly.KeyboardManager.execute("\u2190");break;case 39:a.preventDefault();!a.ctrlKey&&!a.shiftKey&&Firefly.KeyboardManager.execute("\u2192");break;case 65:a.ctrlKey&&
a.preventDefault();break;case 68:a.ctrlKey&&a.preventDefault();break;case 73:a.ctrlKey&&a.shiftKey&&a.preventDefault();break;case 79:a.ctrlKey&&a.preventDefault();break;case 85:a.ctrlKey&&a.preventDefault();break;case 49:a.ctrlKey&&a.preventDefault();break;case 50:a.ctrlKey&&a.preventDefault();break;case 89:a.ctrlKey&&a.preventDefault();break;case 90:a.ctrlKey&&a.preventDefault()}});$(window).keyup(function(a){switch(a.keyCode){case 46:Firefly.KeyboardManager.execute("Delete");break;case 65:a.ctrlKey&&
Firefly.KeyboardManager.execute("Ctrl+A");break;case 68:a.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+D");break;case 73:a.ctrlKey&&a.shiftKey&&Firefly.KeyboardManager.execute("Ctrl+Shift+I");break;case 79:a.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+O");break;case 85:a.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+U");break;case 49:a.ctrlKey&&a.shiftKey?Firefly.KeyboardManager.execute("Ctrl+Shift+1"):a.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+1");break;case 50:a.ctrlKey&&a.shiftKey?
Firefly.KeyboardManager.execute("Ctrl+Shift+2"):a.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+2");break;case 90:a.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+Z");break;case 89:a.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+Y");break;case 67:a.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+C");break;case 86:a.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+V");break;case 88:a.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+X");break;case 38:a.preventDefault();a.ctrlKey&&a.shiftKey?Firefly.KeyboardManager.execute("Ctrl+Shift+\u2191"):
a.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+\u2191");break;case 40:a.preventDefault();a.ctrlKey&&a.shiftKey?Firefly.KeyboardManager.execute("Ctrl+Shift+\u2193"):a.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+\u2193");break;case 37:a.preventDefault();a.ctrlKey&&a.shiftKey?Firefly.KeyboardManager.execute("Ctrl+Shift+\u2190"):a.ctrlKey&&Firefly.KeyboardManager.execute("Ctrl+\u2190");break;case 39:a.preventDefault(),a.ctrlKey&&a.shiftKey?Firefly.KeyboardManager.execute("Ctrl+Shift+\u2192"):a.ctrlKey&&
Firefly.KeyboardManager.execute("Ctrl+\u2192")}})};
Firefly.KeyboardManager.execute=function(a){switch(a){case "Delete":Firefly.HistoryManager.addRemoveSelectedComponentsAction();break;case "Ctrl+Z":Firefly.HistoryManager.undo();break;case "Ctrl+Y":Firefly.HistoryManager.redo();break;case "Ctrl+C":Firefly.Clipboard.copy();break;case "Ctrl+V":Firefly.Clipboard.paste();break;case "Ctrl+X":Firefly.Clipboard.cut();break;case "\u2191":Firefly.HistoryManager.addStepMoveAction("up");break;case "\u2193":Firefly.HistoryManager.addStepMoveAction("down");break;
case "\u2190":Firefly.HistoryManager.addStepMoveAction("left");break;case "\u2192":Firefly.HistoryManager.addStepMoveAction("right");break;case "Ctrl+\u2191":Firefly.HistoryManager.addMoveSelectedComponentLayerAction("up");break;case "Ctrl+\u2193":Firefly.HistoryManager.addMoveSelectedComponentLayerAction("down");break;case "Ctrl+Shift+\u2191":Firefly.HistoryManager.addMoveSelectedComponentLayerAction("top");break;case "Ctrl+Shift+\u2193":Firefly.HistoryManager.addMoveSelectedComponentLayerAction("bottom");
break;case "Ctrl+A":Firefly.HistoryManager.addSelectAllAction();break;case "Ctrl+Shift+I":Firefly.HistoryManager.addInvertSelectAction();break;case "Ctrl+D":Firefly.HistoryManager.addCancelSelectAction();break;case "Ctrl+1":Firefly.topMenu.panelMenuController.getMenu().dropdown("set selected","properties");break;case "Ctrl+2":Firefly.topMenu.panelMenuController.getMenu().dropdown("set selected","history");break;case "Ctrl+Shift+1":Firefly.mainLayout.toggleLeft();break;case "Ctrl+Shift+2":Firefly.mainLayout.toggleRight();
break;case "Ctrl+O":Firefly.openWin.show();break;case "export":Firefly.exportWin.show();break;case "Ctrl+U":Firefly.settingWin.show(0);break;case "showQuickKey":Firefly.settingWin.show(1);break;case "about":Firefly.settingWin.show(2)}};$(function(){Firefly.KeyboardManager.init()});Firefly.HistoryManager={};Firefly.HistoryManager.UPDATE="historyManagerUpdate";Firefly.HistoryManager.maxLen=50;Firefly.HistoryManager.items=[];Firefly.HistoryManager.idx=-1;Firefly.HistoryManager.add=function(a,b,c){for(;this.items.length-1>this.idx;)this.items.pop();a=new Firefly.HistoryItem(a,b,c);this.items.push(a);this.items.length>this.maxLen&&this.items.shift();a.redo();this.idx=this.items.length-1;$(document).trigger(Firefly.HistoryManager.UPDATE)};
Firefly.HistoryManager.undo=function(){this.idx>-1&&(this.items[this.idx].undo(),this.idx--,$(document).trigger(Firefly.HistoryManager.UPDATE))};Firefly.HistoryManager.redo=function(){this.idx<this.items.length-1&&(this.idx++,this.items[this.idx].redo(),$(document).trigger(Firefly.HistoryManager.UPDATE))};Firefly.HistoryManager.removeAll=function(){for(;this.items.length>0;)this.items.pop();this.idx=-1;$(document).trigger(Firefly.HistoryManager.UPDATE)};
Firefly.HistoryManager.go=function(a){for(a=this.items.indexOf(a);this.idx!=a;)a<this.idx?(this.items[this.idx].undo(),this.idx--):(this.idx++,this.items[this.idx].redo());$(document).trigger(Firefly.HistoryManager.UPDATE)};Firefly.HistoryItem=function(a,b,c){this.type=a;this.undo=b;this.redo=c};
Firefly.HistoryManager.addComponentAction=function(a){var b;this.add("new",function(){var a=Firefly.editor.getEditorCanvas();b=a.components[a.components.length-1];a.remove(b)},function(){b==void 0?Firefly.editor.runCmd(a):Firefly.editor.getEditorCanvas().add(b)})};
Firefly.HistoryManager.addSelectAction=function(a,b){Firefly.ArrayUtil.equals(a,b)?Firefly.editor.getEditorCanvas().scaleTool.setTargets(b):this.add(b.length>0?"select":"unselect",function(){Firefly.editor.getEditorCanvas().scaleTool.setTargets(a)},function(){Firefly.editor.getEditorCanvas().scaleTool.setTargets(b)})};
Firefly.HistoryManager.addSelectAllAction=function(){var a=Firefly.editor.getEditorCanvas().components,b=Firefly.editor.getEditorCanvas().scaleTool.targets;a.length>0&&a.length!=b.length&&this.addSelectAction(b.concat(),a.concat())};
Firefly.HistoryManager.addInvertSelectAction=function(){var a=Firefly.editor.getEditorCanvas().components,b=Firefly.editor.getEditorCanvas().scaleTool.targets;if(a.length>0&&a.length-b.length>0){var c=function(){var c=[];$.each(a,function(){b.indexOf(this)==-1&&c.push(this)});return c}();this.addSelectAction(b.concat(),c)}};Firefly.HistoryManager.addCancelSelectAction=function(){var a=Firefly.editor.getEditorCanvas().scaleTool.targets;a.length>0&&this.addSelectAction(a.concat(),[])};
Firefly.HistoryManager.addMoveAction=function(a,b,c){this.add("move",function(){$.each(a,function(a){this.view.css("left",b[a].left);this.view.css("top",b[a].top);this.descriptor.update()});Firefly.editor.getEditorCanvas().scaleTool.update()},function(){$.each(a,function(a){this.view.css("left",c[a].left);this.view.css("top",c[a].top);this.descriptor.update()});Firefly.editor.getEditorCanvas().scaleTool.update()})};var lastTargets,firstPos;
Firefly.HistoryManager.addStepMoveAction=function(a){var b=Firefly.editor.getEditorCanvas().scaleTool.targets.concat();if(b.length>0){var c=function(){var a=[];$.each(b,function(){a.push(this.view.position())});return a}(),e=function(){var b=[];$.each(c,function(){var c={};switch(a){case "up":c.left=this.left;c.top=this.top-1;break;case "down":c.left=this.left;c.top=this.top+1;break;case "left":c.left=this.left-1;c.top=this.top;break;case "right":c.left=this.left+1,c.top=this.top}b.push(c)});return b}();
lastTargets!=void 0&&Firefly.ArrayUtil.equals(lastTargets,b)&&this.items[this.items.length-1].type=="move"?(this.items.pop(),this.addMoveAction(b,firstPos,e)):(lastTargets=b,firstPos=c,this.addMoveAction(b,c,e))}};
Firefly.HistoryManager.addRemoveSelectedComponentsAction=function(){var a=Firefly.editor.getEditorCanvas().scaleTool.targets.concat();a.length!=0&&this.add("del",function(){$.each(a,function(){Firefly.editor.getEditorCanvas().add(this)});Firefly.editor.getEditorCanvas().scaleTool.setTargets(a)},function(){$.each(a,function(){Firefly.editor.getEditorCanvas().remove(this)});Firefly.editor.getEditorCanvas().scaleTool.setTargets([])})};
Firefly.HistoryManager.addScaleSelectedComponentsAction=function(a,b){this.add("scale",function(){Firefly.editor.getEditorCanvas().scaleTool.moveTo(a.x,a.y);Firefly.editor.getEditorCanvas().scaleTool.resizeTo(a.width,a.height);Firefly.editor.getEditorCanvas().scaleTool.update();Firefly.editor.getEditorCanvas().scaleTool.descriptor.update()},function(){Firefly.editor.getEditorCanvas().scaleTool.moveTo(b.x,b.y);Firefly.editor.getEditorCanvas().scaleTool.resizeTo(b.width,b.height);Firefly.editor.getEditorCanvas().scaleTool.update();
Firefly.editor.getEditorCanvas().scaleTool.descriptor.update()})};Firefly.HistoryManager.addPropertiesEditAction=function(a,b,c){this.add("edit",function(){c(a)},function(){c(b)})};Firefly.HistoryManager.addMoveSelectedComponentLayerAction=function(a){var b=Firefly.editor.getEditorCanvas().scaleTool.targets;b.length==1&&this.addMoveLayerAction(b[0],a)};
Firefly.HistoryManager.addMoveLayerAction=function(a,b){function c(){var b=Firefly.editor.getEditorCanvas().components,c=b.indexOf(a),d=c+1;d<b.length&&Firefly.HistoryManager.add("edit",function(){a.view.insertBefore(b[c].view);b.splice(d,1);b.splice(c,0,a)},function(){a.view.insertAfter(b[d].view);b.splice(c,1);b.splice(d,0,a)})}function e(){var b=Firefly.editor.getEditorCanvas().components,c=b.indexOf(a),d=c-1;d>-1&&Firefly.HistoryManager.add("edit",function(){a.view.insertAfter(b[c].view);b.splice(d,
1);b.splice(c,0,a)},function(){a.view.insertBefore(b[d].view);b.splice(c,1);b.splice(d,0,a)})}function d(){var b=Firefly.editor.getEditorCanvas().components,c=Firefly.editor.getEditorCanvas().contentLayer,d=b.indexOf(a);d!=b.length-1&&Firefly.HistoryManager.add("edit",function(){a.view.insertBefore(b[d].view);b.pop();b.splice(d,0,a)},function(){a.view.appendTo(c);b.splice(d,1);b.push(a)})}function f(){var b=Firefly.editor.getEditorCanvas().components,c=Firefly.editor.getEditorCanvas().contentLayer,
d=b.indexOf(a);d>0&&Firefly.HistoryManager.add("edit",function(){a.view.insertAfter(b[d].view);b.shift();b.splice(d,0,a)},function(){a.view.prependTo(c);b.splice(d,1);b.unshift(a)})}switch(b){case "up":c();break;case "down":e();break;case "top":d();break;case "bottom":f()}};Firefly.Clipboard={};Firefly.Clipboard.targets=[];Firefly.Clipboard.isCut=!1;Firefly.Clipboard.copy=function(){var a=Firefly.editor.getEditorCanvas().scaleTool.targets;if(!Firefly.ArrayUtil.equals(a,this.targets)&&a.length>0){var b=this.targets.concat(),c=this.isCut;Firefly.HistoryManager.add("copy",function(){Firefly.Clipboard.targets=b;Firefly.Clipboard.isCut=c},function(){Firefly.Clipboard.targets=a.concat();Firefly.Clipboard.isCut=!1})}};
Firefly.Clipboard.cut=function(){var a=Firefly.editor.getEditorCanvas().scaleTool.targets;if(a.length>0){var b=this.targets.concat(),c=Firefly.editor.getEditorCanvas().scaleTool.targets.concat(),e=this.isCut;Firefly.HistoryManager.add("cut",function(){$.each(Firefly.Clipboard.targets,function(){Firefly.editor.getEditorCanvas().add(this)});Firefly.Clipboard.targets=b;Firefly.editor.getEditorCanvas().scaleTool.setTargets(c);Firefly.Clipboard.isCut=e},function(){Firefly.Clipboard.targets=a.concat();
$.each(Firefly.Clipboard.targets,function(){Firefly.editor.getEditorCanvas().remove(this)});Firefly.editor.getEditorCanvas().scaleTool.setTargets([]);Firefly.Clipboard.isCut=!0})}};
Firefly.Clipboard.paste=function(){if(this.targets.length>0&&this.isCut){var a=Firefly.Clipboard.targets.concat(),b=Firefly.editor.getEditorCanvas().scaleTool.targets.concat();Firefly.HistoryManager.add("paste",function(){$.each(a,function(){Firefly.editor.getEditorCanvas().remove(this)});Firefly.editor.getEditorCanvas().scaleTool.setTargets(b);Firefly.Clipboard.targets=a;Firefly.Clipboard.isCut=!0},function(){$.each(Firefly.Clipboard.targets,function(){Firefly.editor.getEditorCanvas().add(this)});
Firefly.editor.getEditorCanvas().scaleTool.setTargets(Firefly.Clipboard.targets);Firefly.Clipboard.targets=[];Firefly.Clipboard.isCut=!1})}else if(this.targets.length>0&&!this.isCut){var c=[],e=!1,b=Firefly.editor.getEditorCanvas().scaleTool.targets.concat();Firefly.HistoryManager.add("paste",function(){$.each(c,function(){Firefly.editor.getEditorCanvas().remove(this)});Firefly.editor.getEditorCanvas().scaleTool.setTargets(b)},function(){$.each(Firefly.Clipboard.targets,function(b){e?b=c[b]:(b=this.clone(),
c.push(b));Firefly.editor.getEditorCanvas().add(b)});Firefly.editor.getEditorCanvas().scaleTool.setTargets(c);e=!0})}};Firefly.DragItem=function(a,b){this.view=$("<div class='dragItem'></div>");this.img=$("<img>",{src:a});this.img.appendTo(this.view);b!=void 0&&(this.view.outerWidth(b.width),this.view.outerHeight(b.height),this.img.css("max-width",b.width-10),this.img.css("max-height",b.height-10));this.getSnapshot=function(){var b=$("<div class='dragItemSnapshot'></div>");this.img.clone().appendTo(b);return b};this.setTip=function(b){this.view.attr("data-content",b);this.view.attr("data-variation","mini");this.view.popup({position:"bottom center"})}};Firefly.ColorPicker=function(a,b){var c=this;this.view=b;if(this.view==void 0)this.view=$('<div class="colorPicker"><div class="box"></div></div>');var e=this.view.find(".box");this.view.colpick({flat:!1,layout:"hex",submit:1,onChange:function(b,a){var e;if(c.onChange!=void 0)c.onChange("#"+a)},onSubmit:function(b,a){var g="#"+a;e.css("background-color",g);if(c.onSubmit!=void 0)c.onSubmit(g)},color:a});e.css("background-color",a);this.setColor=function(b){e.css("background-color",b);this.view.colpickSetColor(b)}};Firefly.Dropdown=function(a,b){var c=this;this.view=Firefly.FormViewManager.createDropdownView(a,b);this.dropdown=this.view.find(".ui.dropdown");this.fireChangeEvent=!0;this.dropdown.dropdown({onChange:function(b,a,f){if(c.onChange!=void 0&&c.fireChangeEvent)c.onChange(b,a,f)}});this.setValue=function(b){this.fireChangeEvent=!1;this.dropdown.dropdown("set selected",b.toString());this.fireChangeEvent=!0}};Firefly.EditorCanvas=function(a){var b=this;this.view=$("<div style='position:absolute;'></div>");this.view.outerWidth(960);this.view.outerHeight(540);this.view.appendTo(a);this.view.css("background-color","#FFFFFF");this.components=[];this.contentLayer=$("<div style='position:absolute;'></div>");this.contentLayer.appendTo(this.view);this.overLayer=$("<div style='position:absolute;'></div>");this.overLayer.appendTo(this.view);this.topLayer=$("<div style='position:absolute;'></div>");this.topLayer.appendTo(this.view);
this.scaleTool=new Firefly.ScaleTool;this.scaleTool.view.appendTo(this.overLayer);this.alignManager=new Firefly.AlignManager(this);this.enableAutoAlign=!0;this.descriptor=new Firefly.EditorCanvasDescriptor(this);(function(){var c=new Firefly.SelectBox;c.view.appendTo(b.topLayer);a.mousedown(function(a){function d(b){b.preventDefault();var a=b.clientX-h.x,d=b.clientY-h.y;a>=0?(c.view.offset({left:h.x}),c.view.outerWidth(a)):(c.view.offset({left:b.clientX}),c.view.outerWidth(-a));d>=0?(c.view.offset({top:h.y}),
c.view.outerHeight(d)):(c.view.offset({top:b.clientY}),c.view.outerHeight(-d))}function f(){for(var a=[],e=new Firefly.Rect(c.view.position().left,c.view.position().top,c.view.outerWidth(),c.view.outerHeight()),h=0;h<b.components.length;h++){var o=b.components[h].view.position().left,q=b.components[h].view.position().top,p=b.components[h].view.outerWidth(),n=b.components[h].view.outerHeight(),o=new Firefly.Rect(o,q,p,n);Firefly.Rect.testRectCross(e,o)&&a.push(b.components[h])}Firefly.HistoryManager.addSelectAction(g,
a);$(document).unbind("mousemove",d);$(document).unbind("mouseup",f);c.view.hide()}a.preventDefault();$(document).bind("mousemove",d);$(document).bind("mouseup",f);var g=b.scaleTool.targets.concat();b.scaleTool.setTargets([]);var h={x:a.clientX,y:a.clientY};c.view.show();c.view.outerWidth(0);c.view.outerHeight(0);c.view.offset({left:h.x,top:h.y})})})();this.add=function(a){a.view.appendTo(this.contentLayer);this.components.push(a);a.view.mousedown(function(e){function d(a){a.preventDefault();k||(k=
!0);var d={x:a.clientX-l.client.x,y:a.clientY-l.client.y},a=l.scaleToolPos.x+d.x,d=l.scaleToolPos.y+d.y;if(b.enableAutoAlign)d=b.alignManager.update({x:a,y:d}),a=d.x,d=d.y;b.scaleTool.moveTo(a,d)}function f(){$(document).unbind("mousemove",d);$(document).unbind("mouseup",f);b.enableAutoAlign&&b.alignManager.clear();if(k){var a=b.scaleTool.targets.concat(),c=g();Firefly.HistoryManager.addMoveAction(a,m,c)}}function g(){var a=[];$.each(b.scaleTool.targets,function(){a.push(this.view.position())});return a}
e.preventDefault();e.stopImmediatePropagation();$(document).bind("mousemove",d);$(document).bind("mouseup",f);if(b.scaleTool.targets.indexOf(a)<0){var h=b.scaleTool.targets.concat();Firefly.HistoryManager.addSelectAction(h,[a])}var l={client:{x:e.clientX,y:e.clientY},scaleToolPos:{x:b.scaleTool.view.position().left,y:b.scaleTool.view.position().top}},m=g(),k=!1})};this.remove=function(b){this.components.splice(this.components.indexOf(b),1);b.view.remove()};this.toXmlNode=function(){var b=$("<div>");
b.width(this.descriptor.getWidth());b.height(this.descriptor.getHeight());b.css("background-color",this.descriptor.getColor());b.attr("ff-type","EditorCanvas");return b}};Firefly.Editor=function(a){function b(){var b=e.view.outerWidth()+1E3,f=e.view.outerHeight()+1E3,b=b>a.outerWidth()?b:a.outerWidth(),f=f>a.outerHeight()?f:a.outerHeight();c.outerWidth(b);c.outerHeight(f);b=(b-e.view.outerWidth())*0.5;f=(f-e.view.outerHeight())*0.5;e.view.css("left",b);e.view.css("top",f)}this.view=$("<div style='position:absolute;'></div>");this.view.outerWidth("100%");this.view.outerHeight("100%");this.view.css("overflow","auto");this.view.appendTo(a);var c=$("<div style='position:absolute;'></div>");
c.appendTo(this.view);var e=new Firefly.EditorCanvas(c);this.getEditorCanvas=function(){return e};this.scrollToCenter=function(){this.view.scrollTop((c.outerHeight()-a.outerHeight())*0.5);this.view.scrollLeft((c.outerWidth()-a.outerWidth())*0.5)};this.updateSize=function(){b();this.scrollToCenter()};this.testDragDrop=function(b){return(new Firefly.Rect(a.offset().left,a.offset().top,a.outerWidth(),a.outerHeight())).contain(b)};this.globalToLocalPoint=function(b){return new Firefly.Point(b.x-e.view.offset().left,
b.y-e.view.offset().top)};this.runCmd=function(b){function a(){var c=new Firefly.Image(b.src);e.add(c);c.moveTo(b.x,b.y)}switch(b.cmd){case "create":switch(b.type){case "Image":a();break;default:$(document).trigger(Firefly.Event.UnHandledCommand,b)}}};this.exportSource=function(){var b=$("<div>"),a=e.toXmlNode();a.appendTo(b);$.each(e.components,function(){this.toXmlNode().appendTo(a)});return b.html()};this.checkSource=function(b){var a=!0,c;try{c=$(b);if(c.attr("ff-type")==void 0||c.attr("ff-type")!=
"EditorCanvas")return a=!1;c.children().each(function(){$(this).attr("ff-type")==void 0&&(a=!1)})}catch(e){a=!1}return a};this.importSource=function(b){for(b=$(b);e.components.length>0;)e.remove(e.components[0]);Firefly.HistoryManager.removeAll();e.descriptor.setWidth(b.width());e.descriptor.setHeight(b.height());var a=b.css("background-color"),a=Firefly.Color.getCSSHexColor(a);e.descriptor.setColor(a);Firefly.editor.getEditorCanvas().scaleTool.setTargets([]);b.children().each(function(){var b=$(this).attr("ff-type"),
b=Firefly[b].create($(this));e.add(b)})};$(window).resize(b);b();this.scrollToCenter()};Firefly.ScaleTool=function(){function a(b){this.direction=b;var a={width:10,height:10},d=this,f={"left-up":"nw-resize","right-up":"ne-resize","left-down":"sw-resize","right-down":"se-resize","left-middle":"w-resize","right-middle":"e-resize","up-middle":"n-resize","down-middle":"s-resize"};this.view=$("<div class='controlBtn'><div class='circle'></div>");this.view.css("cursor",f[b]);this.onDrag=function(b,a,c){this.dragStart=b;this.dragMove=a;this.dragEnd=c};this.view.mousedown(function(g){function h(f){function h(){var b=
{width:k.width,height:k.height};b.width=k.width<0?0:k.width;b.height=k.height<0?0:k.height;var b=b.width/b.height<d.rect.width/d.rect.height?b.width/d.rect.width:b.height/d.rect.height,c=d.rect.width<d.rect.height?a.width/d.rect.width:a.height/d.rect.height,b=b<c?c:b;return{width:d.rect.width*b,height:d.rect.height*b}}function g(){var b={width:k.width,height:k.height};b.width=k.width<a.width?a.width:k.width;b.height=k.height<a.height?a.height:k.height;return b}var n={x:f.clientX-m.x,y:f.clientY-m.y},
l,r;switch(b){case "left-up":k.width=d.rect.width-n.x;k.height=d.rect.height-n.y;n=f.shiftKey?h():g();l=d.rect.width-n.width;r=d.rect.height-n.height;break;case "left-down":k.width=d.rect.width-n.x;k.height=d.rect.height+n.y;n=f.shiftKey?h():g();l=d.rect.width-n.width;r=n.height;break;case "right-up":k.width=d.rect.width+n.x;k.height=d.rect.height-n.y;n=f.shiftKey?h():g();l=n.width;r=d.rect.height-n.height;break;case "right-down":k.width=d.rect.width+n.x;k.height=d.rect.height+n.y;n=f.shiftKey?h():
g();l=n.width;r=n.height;break;case "left-middle":k.width=d.rect.width-n.x;n=g();l=d.rect.width-n.width;break;case "right-middle":k.width=d.rect.width+n.x;n=g();l=n.width;break;case "up-middle":k.height=d.rect.height-n.y;n=g();r=d.rect.height-n.height;break;case "down-middle":k.height=d.rect.height+n.y,n=g(),r=n.height}d.view.css("left",l);d.view.css("top",r);d.dragMove!=void 0&&d.dragMove(f)}function l(b){d.view.removeClass("selected");$(document).unbind("mousemove",h);$(document).unbind("mouseup",
l);$(document.body).css("cursor","auto");d.dragEnd!=void 0&&d.dragEnd(b)}g.preventDefault();g.stopImmediatePropagation();d.view.addClass("selected");$(document).bind("mousemove",h);$(document).bind("mouseup",l);$(document.body).css("cursor",f[b]);var m={x:g.clientX,y:g.clientY},k={width:d.rect.width,height:d.rect.height};d.dragStart!=void 0&&d.dragStart(g)});this.setPosForRect=function(a){this.rect=a;var d,e;switch(b){case "left-up":e=d=0;break;case "right-up":d=a.width;e=0;break;case "left-down":d=
0;e=a.height;break;case "right-down":d=a.width;e=a.height;break;case "left-middle":d=0;e=a.height*0.5;break;case "right-middle":d=a.width;e=a.height*0.5;break;case "up-middle":d=a.width*0.5;e=0;break;case "down-middle":d=a.width*0.5,e=a.height}this.view.css("left",d);this.view.css("top",e)}}var b=this;this.targets=[];this.view=$("<div class='scaleTool'></div>");this.box=$("<div class='box'></div>");this.box.appendTo(this.view);this.descriptor=new Firefly.MultipleSelectDescriptor;this.controlBtns=
function(){function c(){o=!1;l=new Firefly.Rect(b.view.position().left,b.view.position().top,b.box.outerWidth(),b.box.outerHeight());k=b.getInitLayouts(l)}function e(){if(!o){o=!0;for(var a=0;a<b.targets.length;a++){var c=b.targets[a];c.getAutoSize()&&(!c.lockWidth||!c.lockHeight)&&c.setAutoSize(!1)}}c=this.view.position().left;a=this.view.position().top;switch(this.direction){case "left-up":b.controlBtns["left-middle"].view.css("left",c);b.controlBtns["left-down"].view.css("left",c);c=(b.controlBtns["right-middle"].view.position().left-
c)*0.5+c;b.controlBtns["up-middle"].view.css("left",c);b.controlBtns["down-middle"].view.css("left",c);var d=(b.controlBtns["down-middle"].view.position().top-a)*0.5+a;b.controlBtns["left-middle"].view.css("top",d);b.controlBtns["right-middle"].view.css("top",d);b.controlBtns["up-middle"].view.css("top",a);b.controlBtns["right-up"].view.css("top",a);break;case "right-up":b.controlBtns["left-up"].view.css("top",a);b.controlBtns["up-middle"].view.css("top",a);b.controlBtns["right-middle"].view.css("left",
c);b.controlBtns["right-down"].view.css("left",c);c*=0.5;d=(b.controlBtns["down-middle"].view.position().top-a)*0.5+a;b.controlBtns["up-middle"].view.css("left",c);b.controlBtns["down-middle"].view.css("left",c);b.controlBtns["left-middle"].view.css("top",d);b.controlBtns["right-middle"].view.css("top",d);break;case "left-down":b.controlBtns["left-up"].view.css("left",c);b.controlBtns["left-middle"].view.css("left",c);b.controlBtns["down-middle"].view.css("top",a);b.controlBtns["right-down"].view.css("top",
a);c=(b.controlBtns["right-middle"].view.position().left-c)*0.5+c;d=a*0.5;b.controlBtns["up-middle"].view.css("left",c);b.controlBtns["down-middle"].view.css("left",c);b.controlBtns["left-middle"].view.css("top",d);b.controlBtns["right-middle"].view.css("top",d);break;case "right-down":b.controlBtns["right-up"].view.css("left",c);b.controlBtns["right-middle"].view.css("left",c);b.controlBtns["left-down"].view.css("top",a);b.controlBtns["down-middle"].view.css("top",a);c*=0.5;d=a*0.5;b.controlBtns["up-middle"].view.css("left",
c);b.controlBtns["down-middle"].view.css("left",c);b.controlBtns["left-middle"].view.css("top",d);b.controlBtns["right-middle"].view.css("top",d);break;case "left-middle":b.controlBtns["left-up"].view.css("left",c);b.controlBtns["left-down"].view.css("left",c);c=(b.controlBtns["right-middle"].view.position().left-c)*0.5+c;b.controlBtns["up-middle"].view.css("left",c);b.controlBtns["down-middle"].view.css("left",c);break;case "right-middle":b.controlBtns["right-up"].view.css("left",c);b.controlBtns["right-down"].view.css("left",
c);c*=0.5;b.controlBtns["up-middle"].view.css("left",c);b.controlBtns["down-middle"].view.css("left",c);break;case "up-middle":b.controlBtns["left-up"].view.css("top",a);b.controlBtns["right-up"].view.css("top",a);d=(b.controlBtns["down-middle"].view.position().top-a)*0.5+a;b.controlBtns["left-middle"].view.css("top",d);b.controlBtns["right-middle"].view.css("top",d);break;case "down-middle":b.controlBtns["left-down"].view.css("top",a),b.controlBtns["right-down"].view.css("top",a),d=a*0.5,b.controlBtns["left-middle"].view.css("top",
d),b.controlBtns["right-middle"].view.css("top",d)}a=new Firefly.Rect(b.controlBtns["left-up"].view.position().left,b.controlBtns["left-up"].view.position().top,b.controlBtns["right-up"].view.position().left-b.controlBtns["left-up"].view.position().left,b.controlBtns["left-down"].view.position().top-b.controlBtns["left-up"].view.position().top);b.box.css("left",a.x);b.box.css("top",a.y);b.box.outerWidth(a.width);b.box.outerHeight(a.height);m=new Firefly.Rect(b.view.position().left+a.x,b.view.position().top+
a.y,a.width,a.height);b.resizeTargets(k,m);b.descriptor.update(m)}function d(){b.view.offset(b.box.offset());b.box.css("left",0);b.box.css("top",0);b.update();o&&Firefly.HistoryManager.addScaleSelectedComponentsAction(l,m)}for(var f={},g=["left-up","right-up","left-down","right-down","left-middle","right-middle","up-middle","down-middle"],h=g.length,l,m,k,o,q=0;q<h;q++){var p=new a(g[q]);f[g[q]]=p;p.view.appendTo(b.view);p.onDrag(c,e,d)}return f}();this.view.hide();this.setTargets=function(b){this.targets=
b;b.length==0?this.view.hide():(this.view.show(),this.update());Firefly.propertiesPanel.setTargets(b)};this.update=function(){if(this.targets.length!=0){var a=this.getRectOfTargets();this.view.css("left",a.x);this.view.css("top",a.y);this.box.outerWidth(a.width);this.box.outerHeight(a.height);(function(){var e={none:[],all:["left-up","right-up","left-down","right-down","left-middle","right-middle","up-middle","down-middle"],width:["left-middle","right-middle"],height:["up-middle","down-middle"]},
d=e.all;if(b.targets.length==1){var f=b.targets[0];if(f.getAutoSize()||f.lockWidth&&f.lockHeight)d=e.none;else if(f.lockWidth&&!f.lockHeight)d=e.height;else if(!f.lockWidth&&f.lockHeight)d=e.width}for(direction in b.controlBtns)e=b.controlBtns[direction],e.setPosForRect(a),d.indexOf(direction)>-1?(e.view.css("pointer-events","auto"),e.view.css("opacity",1)):(e.view.css("pointer-events","none"),e.view.css("opacity",0))})()}};this.getRectOfTargets=function(){var b,a,d,f;f=this.targets[0];b=f.view.position().left;
a=f.view.position().top;d=b+f.view.outerWidth();f=a+f.view.outerHeight();if(this.targets.length>1)for(var g=1;g<this.targets.length;g++){var h=this.targets[g].view.position().left,l=this.targets[g].view.position().top,m=h+this.targets[g].view.outerWidth(),k=l+this.targets[g].view.outerHeight();b=b>h?h:b;a=a>l?l:a;d=d<m?m:d;f=f<k?k:f}return new Firefly.Rect(b,a,d-b,f-a)};this.moveTo=function(b,a){var d={};if(b!=void 0)d.x=b-this.view.position().left,this.view.css("left",b);if(a!=void 0)d.y=a-this.view.position().top,
this.view.css("top",a);for(var f=0;f<this.targets.length;f++){var g,h;b!=void 0&&(g=this.targets[f].view.position().left+d.x);a!=void 0&&(h=this.targets[f].view.position().top+d.y);this.targets[f].moveTo(g,h)}this.descriptor.update()};this.resizeTo=function(b,a){var b=b==void 0?this.box.outerWidth():b,a=a==void 0?this.box.outerHeight():a,d=new Firefly.Rect(this.view.position().left,this.view.position().top,this.box.outerWidth(),this.box.outerHeight()),f=new Firefly.Rect(d.x,d.y,b,a);this.resizeTargets(d,
f);this.box.outerWidth(b);this.box.outerHeight(a)};this.getInitLayouts=function(a){for(var e=[],d=0;d<this.targets.length;d++){var f=b.targets[d];e.push({x:(f.view.position().left-a.x)/a.width,y:(f.view.position().top-a.y)/a.height,w:f.view.outerWidth()/a.width,h:f.view.outerHeight()/a.height,left:f.view.position().left-a.x,right:a.x+a.width-f.view.position().left-f.view.outerWidth(),top:f.view.position().top-a.y,down:a.y+a.height-f.view.position().top-f.view.outerHeight()})}return e};this.resizeTargets=
function(a,e){var d;d=a instanceof Firefly.Rect?this.getInitLayouts(a):a;for(var f=0;f<this.targets.length;f++){var g=b.targets[f],h=d[f],l=e.x+e.width*h.x,m=e.y+e.height*h.y,k=e.width*h.w,o=e.height*h.h;g.lockWidth&&(l=h.left==0?e.x:l,l=h.right==0?e.x+e.width-g.view.outerWidth():l,l=l+g.view.outerWidth()<e.x+e.width?l:e.x+e.width-g.view.outerWidth(),l=l>e.x?l:e.x);g.lockHeight&&(m=h.top==0?e.y:m,m=h.down==0?e.y+e.height-g.view.outerHeight():m,m=m+g.view.outerHeight()<e.y+e.height?m:e.y+e.height-
g.view.outerHeight(),m=m>e.y?m:e.y);g.moveTo(l,m);g.resizeTo(k,o)}}};Firefly.AlignManager=function(a){function b(){e.lineX!=void 0&&e.lineX.remove()}function c(){e.lineY!=void 0&&e.lineY.remove()}var e=this;this.fix=5;this.update=function(d){var f=d.y,g,d=d.x,h=a.scaleTool.box.outerWidth(),l=[d,d+h*0.5,d+h],h=a.view.width(),h=[0,h*0.5,h];for(i=0;i<a.components.length;i++)if(a.scaleTool.targets.indexOf(a.components[i])==-1)var m=a.components[i].view.position().left,k=a.components[i].view.outerWidth(),h=h.concat([m,m+k*0.5,m+k]);for(i=0;i<l.length;i++){for(j=0;j<h.length;j++)if(Math.abs(l[i]-
h[j])<e.fix){g=[i,j];break}if(g!=void 0)break}if(g!=void 0){d=h[g[1]];if(e.lineX==void 0)e.lineX=$("<div style='position:absolute;border-left:dashed 1px #FF0000;width:0px;'></div>");e.lineX.css("height",a.view.height());e.lineX.appendTo(a.overLayer);e.lineX.css("left",d);d=g[0];g=h[g[1]];d!=0&&(d==1?g-=a.scaleTool.box.outerWidth()*0.5:d==2&&(g-=a.scaleTool.box.outerWidth()));d=g}else b();g=d;d=a.scaleTool.box.outerHeight();h=[f,f+d*0.5,f+d];d=a.view.height();d=[0,d*0.5,d];for(i=0;i<a.components.length;i++)if(a.scaleTool.targets.indexOf(a.components[i])==
-1)l=a.components[i].view.position().top,m=a.components[i].view.outerHeight(),d=d.concat([l,l+m*0.5,l+m]);var o;for(i=0;i<h.length;i++){for(j=0;j<d.length;j++)if(Math.abs(h[i]-d[j])<e.fix){o=[i,j];break}if(o!=void 0)break}if(o!=void 0){f=d[o[1]];if(e.lineY==void 0)e.lineY=$("<div style='position:absolute;border-top:dashed 1px #FF0000;height:0px;'></div>");e.lineY.css("width",a.view.width());e.lineY.appendTo(a.overLayer);e.lineY.css("top",f);f=o[0];o=d[o[1]];f!=0&&(f==1?o-=a.scaleTool.box.outerHeight()*
0.5:f==2&&(o-=a.scaleTool.box.outerHeight()));f=o}else c();return{x:g,y:f}};this.clear=function(){b();c()}};Firefly.SelectBox=function(){this.view=$('<div style="position:absolute;border: solid 1px #0000ff;"></div>');this.view.hide()};Firefly.ResourcePanel=function(){function a(a){function c(c){var f=a.getIconUrl(g[c]),m=new Firefly.DragItem(f,a.item);m.view.appendTo(d);m.view.mousedown(function(){function d(a){a.preventDefault();l||(l=!0,p=m.getSnapshot(),p.offset({left:a.clientX,top:a.clientY}),p.appendTo("body"));p!=void 0&&p.offset({left:a.clientX,top:a.clientY})}function f(){p!=void 0&&(a.onSnapshotDrop(g[c],p),p.remove());$(document).unbind("mousemove",d);$(document).unbind("mouseup",f)}e(m);$(document).bind("mousemove",
d);$(document).bind("mouseup",f);var l=!1,p});if(a.onItemCreate!=void 0)a.onItemCreate(g[c],m)}function e(a){f!=void 0&&f.view.removeClass("selected");f=a;a.view.addClass("selected")}var d=a.view,f,g;$.getJSON(a.listUrl,function(d){g=d;for(var d=g.length,e=0;e<d;e++)new c(e);if(a.onItemsCreateComplete!=void 0)a.onItemsCreateComplete()})}new function(){var b={view:$("#componentContainer"),listUrl:"componentLib/list.json",getIconUrl:function(a){return"componentLib/"+a+"/icon.png"},onSnapshotDrop:function(a,
b){var d=new Firefly.Point(b.offset().left,b.offset().top);if(Firefly.editor.testDragDrop(d)){var f={cmd:"create",type:a},d=Firefly.editor.globalToLocalPoint(d);f.x=d.x;f.y=d.y;Firefly.HistoryManager.addComponentAction(f)}},item:{width:50,height:50},onItemCreate:function(a,b){b.view.css("pointer-events","none");b.view.css("opacity",0.5);Firefly.ComponentManager.append(a,function(a){b.view.css("pointer-events","auto");b.view.css("opacity",1);b.setTip(a.desc)})},onItemsCreateComplete:function(){Firefly.ComponentManager.startLoad()}};
a.call(this,b)};new function(){var b={view:$("#photoContainer"),listUrl:"photoLib/list.json",getIconUrl:function(a){return"photoLib/"+a},onSnapshotDrop:function(a,b){var d=new Firefly.Point(b.offset().left,b.offset().top),f="photoLib/"+a;if(Firefly.editor.testDragDrop(d))f={cmd:"create",type:"Image",src:f},d=Firefly.editor.globalToLocalPoint(d),f.x=d.x,f.y=d.y,Firefly.HistoryManager.addComponentAction(f)}};a.call(this,b)}};
Firefly.ComponentManager={loadItems:[],loadComponent:function(a,b){$.getJSON("componentLib/"+a+"/config.json",function(c){if(c.require.length==0)b(c);else{var e=0;$.each(c.require,function(d,f){$.getScript("componentLib/"+a+"/"+f,function(){e++;e==c.require.length&&b(c)})})}})},append:function(a,b){this.loadItems.push({dir:a,onComplete:b})},startLoad:function(a){function b(e){var d=c.loadItems[e];c.loadComponent(d.dir,function(f){d.onComplete(f);e++;e<c.loadItems.length?b(e):a!=void 0&&a()})}var c=
this;b(0)}};Firefly.PropertiesPanel=function(){this.view=$("#propertiesPanel");this.header=this.view.find("#header");this.form=this.view.find(".ui.form");this.layoutPanel=this.view.find("#layoutPanel");this.setTargets=function(a){this.clear();var b=a.length;b==0?Firefly.editor.getEditorCanvas().descriptor.init(this):b==1?a[0].descriptor.init(this):Firefly.editor.getEditorCanvas().scaleTool.descriptor.init(this)};this.clear=function(){this.view.find(".ui.dropdown").dropdown("hide");var a=$(document).find(".colpick.colpick_hex");
a.length>0&&a.each(function(){$(this).data("colpick").clear();$(this).remove()});this.header.text("");this.form.empty();this.layoutPanel.empty()};this.setTargets([])};Firefly.HistoryPanel=function(){function a(){var a=Firefly.HistoryManager.items.length,b=Firefly.HistoryManager.idx;a==0?(e.addClass("disabled"),d.addClass("disabled"),f.addClass("disabled")):(f.removeClass("disabled"),b==a-1?(d.addClass("disabled"),e.removeClass("disabled")):(b==-1?e.addClass("disabled"):e.removeClass("disabled"),d.removeClass("disabled")));g.empty();a=Firefly.HistoryManager.items.length;if(a==0)g.text("\u6ca1\u6709\u4efb\u4f55\u5386\u53f2\u8bb0\u5f55");else for(var b=[],c=Firefly.HistoryManager.idx,
k=0;k<a;k++){var o=new Firefly.HistoryItemView(Firefly.HistoryManager.items[k]);o.view.prependTo(g);b.push(o);k==c&&b[k].view.addClass("active")}}var b=$("#historyPanel"),c=b.find(".ui.tab.segment .menu .item"),e=c.eq(0),d=c.eq(1),f=c.eq(2),g=b.find(".ui.tab.segment .list");a();e.click(function(){Firefly.HistoryManager.undo()});d.click(function(){Firefly.HistoryManager.redo()});f.click(function(){Firefly.HistoryManager.removeAll()});$(document).bind(Firefly.HistoryManager.UPDATE,a);this.getUndoAble=
function(){return!e.hasClass("disabled")};this.getRedoAble=function(){return!d.hasClass("disabled")}};
Firefly.HistoryItemView=function(a){var b={"new":{icon:"add circle icon",label:"\u6dfb\u52a0\u4e86\u7ec4\u4ef6"},del:{icon:"trash icon",label:"\u5220\u9664\u4e86\u7ec4\u4ef6"},select:{icon:"check circle icon",label:"\u9009\u62e9\u4e86\u7ec4\u4ef6"},unselect:{icon:"circle thin icon",label:"\u53d6\u6d88\u4e86\u9009\u62e9"},move:{icon:"move icon",label:"\u79fb\u52a8\u4e86\u7ec4\u4ef6"},scale:{icon:"expand icon",label:"\u7f29\u653e\u4e86\u7ec4\u4ef6"},edit:{icon:"edit icon",label:"\u7f16\u8f91\u4e86\u7ec4\u4ef6"},
copy:{icon:"copy icon",label:"\u590d\u5236\u4e86\u7ec4\u4ef6"},paste:{icon:"paste icon",label:"\u7c98\u8d34\u4e86\u7ec4\u4ef6"},cut:{icon:"cut icon",label:"\u526a\u5207\u4e86\u7ec4\u4ef6"}};this.view=$('<div class="item"></div>');this.icon=$('<i class="'+b[a.type].icon+'"></i>');this.content=$('<div class="content"><div class="header">'+b[a.type].label+"</div></div>");this.icon.appendTo(this.view);this.content.appendTo(this.view);this.view.click(function(){Firefly.HistoryManager.go(a)})};Firefly.ComponentBase=function(){this.view=$('<div style="width:100px; height:100px;position:absolute;"></div>');this.lockHeight=this.lockWidth=!1;this.descriptor=new Firefly.ComponentBaseDescriptor(this);this.moveTo=function(a,b){a!=void 0&&this.view.css("left",a);b!=void 0&&this.view.css("top",b);this.descriptor.update()};this.resizeTo=function(a,b){a!=void 0&&!this.lockWidth&&this.view.outerWidth(a);b!=void 0&&!this.lockHeight&&this.view.outerHeight(b);this.descriptor.update()};this.getAutoSize=
function(){return this.view.attr("ff-autoSize")=="true"?!0:!1};this.setAutoSize=function(a){this.view.attr("ff-autoSize",a?"true":"false");this.descriptor.update()};this.clone=function(){var a=new Firefly.ComponentBase;a.view=this.view.clone();return a};this.toXmlNode=function(){var a=this.view.clone();a.attr("ff-type","ComponentBase");return a}};Firefly.ComponentBase.create=function(a){var b=new Firefly.ComponentBase;b.view=a;return b};Firefly.ImageScaleMode={Stretch:0,Inside:1,Outside:2};
Firefly.Image=function(a){Firefly.ComponentBase.call(this);var b=this;this.img=$("<img>",{src:a,style:"position:absolute;"});this.view.css("overflow","hidden");this.descriptor=new Firefly.ImageDescriptor(this);this.view.attr("ff-autoSize","true");this.img.get(0).onload=function(){b.img.appendTo(b.view);b.setOriginSize(b.img.width(),b.img.height());b.view.outerWidth(b.img.width());b.view.outerHeight(b.img.height())};this.getOriginSize=function(){var a=this.view.attr("ff-originSize");a!=void 0&&(a=
a.split(","),a={width:a[0],height:a[1]});return a};this.setOriginSize=function(a,b){this.view.attr("ff-originSize",[a,b].join(","))};this.getScaleMode=function(){var a=this.view.attr("ff-scaleMode");return a=a==void 0?0:parseInt(a)};this.setScaleMode=function(a){this.view.attr("ff-scaleMode",a);var a=this.view.outerWidth(),b=this.view.outerHeight();this.resizeTo(a,b)};var c=this.setAutoSize;this.setAutoSize=function(a){a&&(this.view.width(this.getOriginSize().width),this.view.height(this.getOriginSize().height),
this.img.width(this.getOriginSize().width),this.img.height(this.getOriginSize().height),this.img.css("left",0),this.img.css("top",0));c.call(this,a)};var e=this.resizeTo;this.resizeTo=function(a,b){a=a==void 0?this.view.outerWidth():a;b=b==void 0?this.view.outerHeight():b;if(this.getScaleMode()==Firefly.ImageScaleMode.Stretch)this.img.width(a),this.img.height(b),this.img.css("left",0),this.img.css("top",0);else if(this.getScaleMode()==Firefly.ImageScaleMode.Inside){var c=a/this.getOriginSize().width<
b/this.getOriginSize().height?a/this.getOriginSize().width:b/this.getOriginSize().height;this.img.width(this.getOriginSize().width*c);this.img.height(this.getOriginSize().height*c);var c=(a-this.img.width())*0.5,h=(b-this.img.height())*0.5;this.img.css("left",c);this.img.css("top",h)}else this.getScaleMode()==Firefly.ImageScaleMode.Outside&&(c=a/this.getOriginSize().width>b/this.getOriginSize().height?a/this.getOriginSize().width:b/this.getOriginSize().height,this.img.width(this.getOriginSize().width*
c),this.img.height(this.getOriginSize().height*c),c=(a-this.img.width())*0.5,h=(b-this.img.height())*0.5,this.img.css("left",c),this.img.css("top",h));e.call(this,a,b)};this.clone=function(){var a=new Firefly.Image;a.view=this.view.clone();a.img=a.view.find("img").eq(0);return a};this.toXmlNode=function(){var a=this.view.clone();a.attr("ff-type","Image");return a}};Firefly.Image.create=function(a){var b=new Firefly.Image;b.view=a;b.img=b.view.find("img").eq(0);return b};Firefly.TopMenu=function(a){function b(){$.each(d,function(){this.update()})}function c(a){function b(){if(d!="")Firefly.KeyboardManager.execute(d);else switch(c){case "\u5bfc\u51fa":Firefly.KeyboardManager.execute("export");break;case "\u952e\u76d8\u5feb\u6377\u952e":Firefly.KeyboardManager.execute("showQuickKey");break;case "\u5173\u4e8eFirefly":Firefly.KeyboardManager.execute("about")}}var c=a.find("span.text").eq(0).text();a.find(".item").length==0&&a.click(b);var d=a.find("span.description").text();
this.update=function(){var a=!0;switch(c){case "\u64a4\u6d88":a=Firefly.historyPanel.getUndoAble();break;case "\u91cd\u505a":a=Firefly.historyPanel.getRedoAble();break;case "\u5220\u9664":a=Firefly.editor.getEditorCanvas().scaleTool.targets.length>0;break;case "\u590d\u5236":a=Firefly.editor.getEditorCanvas().scaleTool.targets.length>0;break;case "\u526a\u5207":a=Firefly.editor.getEditorCanvas().scaleTool.targets.length>0;break;case "\u7c98\u8d34":a=Firefly.Clipboard.targets.length>0;break;case "\u79fb\u52a8":a=
Firefly.editor.getEditorCanvas().scaleTool.targets.length>0;break;case "\u7f6e\u9876":a=Firefly.editor.getEditorCanvas().scaleTool.targets.length==1;break;case "\u7f6e\u5e95":a=Firefly.editor.getEditorCanvas().scaleTool.targets.length==1;break;case "\u4e0a\u79fb\u4e00\u5c42":a=Firefly.editor.getEditorCanvas().scaleTool.targets.length==1;break;case "\u4e0b\u79fb\u4e00\u5c42":a=Firefly.editor.getEditorCanvas().scaleTool.targets.length==1;break;case "\u5168\u9009":a=Firefly.editor.getEditorCanvas().components.length>
0&&Firefly.editor.getEditorCanvas().components.length!=Firefly.editor.getEditorCanvas().scaleTool.targets.length;break;case "\u53cd\u9009":a=Firefly.editor.getEditorCanvas().components.length>0&&Firefly.editor.getEditorCanvas().components.length-Firefly.editor.getEditorCanvas().scaleTool.targets.length>0;break;case "\u53d6\u6d88\u9009\u62e9":a=Firefly.editor.getEditorCanvas().scaleTool.targets.length>0;break;case "\u5c5e\u6027\u9762\u677f":a=Firefly.topMenu.panelMenuController.getSelectedValue()!=
"properties";break;case "\u5386\u53f2\u8bb0\u5f55":a=Firefly.topMenu.panelMenuController.getSelectedValue()!="history"}this.setEnabled(a)};this.setEnabled=function(b){b?a.removeClass("disabled"):a.addClass("disabled")}}this.view=$(a);a=this.view.find(".ui.dropdown:not(.right.menu .ui.dropdown)");a.dropdown({on:"hover",onShow:function(){b()}});var e=a.find(".item"),d=[];e.each(function(){d.push(new c($(this)))});this.panelMenuController=new function(a){var b=this,c,d={properties:$("#propertiesPanel"),
history:$("#historyPanel")};$.each(d,function(){$(this).css("display","none")});this.selectValue=function(a){c!=void 0&&d[c].css("display","none");c=a;d[c].css("display","block")};this.getSelectedValue=function(){return c};this.getMenu=function(){return a};this.selectValue("properties");a.dropdown("set selected",c);a.dropdown({onChange:function(a){b.selectValue(a)}})}(this.view.find(".right.menu .ui.dropdown").eq(0));this.getItems=function(){return e}};Firefly.SettingWin=function(a){function b(a,b){this.setDisplay=function(c){a.css("display",c?"block":"none");b.css("display",c?"block":"none")}}var c=this;this.view=$(a);var e=this.view.find(".ui.menu .item"),a=this.view.find(".content").eq(0).children(),d=this.view.find(".actions").eq(0).children(),f=[new function(a,c){b.call(this,a,c);var d=this,e=a.find(".ui.checkbox"),f=a.find("input").eq(1),g=a.find("input").eq(2),p=c.find("button").eq(0);this.getEnableAlign=function(){return Firefly.editor.getEditorCanvas().enableAutoAlign};
this.setEnableAlign=function(a){Firefly.editor.getEditorCanvas().enableAutoAlign=a};this.getDis=function(){return Firefly.editor.getEditorCanvas().alignManager.fix};this.setDis=function(a){Firefly.editor.getEditorCanvas().alignManager.fix=a};this.getMaxHistory=function(){return Firefly.HistoryManager.maxLen};this.setMaxHistory=function(a){Firefly.HistoryManager.maxLen=a};this.initValues=function(){var a=this.getEnableAlign();e.checkbox(a?"set checked":"set unchecked");f.parent()[a?"removeClass":"addClass"]("disabled");
f.val(this.getDis());g.val(this.getMaxHistory())};this.initValues();e.checkbox({onChange:function(){var a=e.checkbox("is checked");f.parent()[a?"removeClass":"addClass"]("disabled")}});p.click(function(){var a=e.checkbox("is checked");d.setEnableAlign(a);d.setDis(f.val());d.setMaxHistory(g.val())})}(a.eq(0),d.eq(0)),new function(a,c){b.call(this,a,c);var d='<table class="ui celled table">';d+=" <thead><tr>";d+="  <th>\u5feb\u6377\u952e</th>";d+="  <th>\u8bf4\u660e</th>";d+=" </tr></thead>";d+=" <tbody>";
Firefly.topMenu.getItems().each(function(){if($(this).find(".item").length==0){var a=$(this).find("span.text").text(),b=$(this).find("span.description").text();b!=""&&(d+="<tr><td>"+b+"</td><td>"+a+"</td></tr>")}});d+=" </tbody>";d+="</table>";$(d).appendTo(a)}(a.eq(1),d.eq(1)),new function(a,c){b.call(this,a,c);var d=this,e=$("<audio>",{src:"assets/sounds/m01.m4a",loop:!0}),f=a.find(".icon.music");f.addClass("red");f.click(function(){f.toggleClass("red");f.hasClass("red")?d.playMusic():d.stopMusic()});
var g=this.setDisplay;this.setDisplay=function(b){g.call(this,b);a.parent().css("background-color",b?"#000000":"#ffffff");b?this.playMusic():this.stopMusic()};this.playMusic=function(){f.hasClass("red")&&e.get(0).play()};this.stopMusic=function(){e.get(0).pause();e.get(0).currentTime=0};var p='<div style="color:#999999;text-align: center;">'+Base64.decode("Qmxhbms=")+"</div>";p+='<div style="color:#999999;text-align: center;">'+Base64.decode("aGVyb2JsYW5rQGdtYWlsLmNvbQ==")+"</div>";$(p).appendTo(a)}(a.eq(2),
d.eq(2))],g=-1;e.each(function(a){$(this).click(function(){c.selectTabIdx(a)})});this.view.modal({onHide:function(){f[2].stopMusic()}});this.show=function(a){f[0].initValues();this.selectTabIdx(a);this.view.modal("show")};this.selectTabIdx=function(a){g>-1&&(e.eq(g).removeClass("active blue"),f[g].setDisplay(!1));e.eq(a).addClass("active blue");g=a;f[a].setDisplay(!0);this.view.modal("refresh")}};Firefly.OpenWin=function(a){var b=this;this.view=$(a);var c=this.view.find("textarea").eq(0),e=this.view.find(".actions button").eq(0),d=this.view.find(".message");d.find(".close").click(function(){d.transition("scale out")});e.click(function(){c.closest(".field").removeClass("error");d.transition("hide");var a=c.val();Firefly.editor.checkSource(a)?(Firefly.editor.importSource(a),e.addClass("loading disabled"),b.view.modal("hide")):(d.transition("scale in"),c.closest(".field").addClass("error"))});
this.show=function(){e.removeClass("loading disabled");c.val("");c.closest(".field").removeClass("error");d.transition("hide");this.view.modal("show")}};Firefly.ExportWin=function(a){this.view=$(a);var b=this.view.find("textarea").eq(0),c=this.view.find(".actions button").eq(0),e=this.view.find(".message"),d=e.eq(0),f=e.eq(1);c.attr("data-clipboard-target",a+" textarea");a=new Clipboard(a+" .actions button");a.on("success",function(){f.transition("hide");d.transition("scale in")});a.on("error",function(){d.transition("hide");f.transition("scale in")});e.find(".close").click(function(){$(this).closest(".message").transition("scale out")});this.show=
function(){b.val(this.getExportSource());d.transition("hide");f.transition("hide");this.view.modal("show")};this.getExportSource=function(){return Firefly.editor.exportSource()}};Firefly.EditorCanvasDescriptor=function(a){var b=this;this.title="\u753b\u5e03";this.initComplete=!1;this.init=function(a){this.createChildren(a);this.initComplete=!0;this.update()};this.createChildren=function(a){a.header.text(this.title);var a=a.form,e=Firefly.FormViewManager.createSizeView();e.appendTo(a);Firefly.FormViewManager.createHline().appendTo(a);var d=Firefly.FormViewManager.createColorPickerView("\u80cc\u666f\u989c\u8272");d.appendTo(a);this.colorPicker=new Firefly.ColorPicker(this.getColor(),
d.find(".colorPicker"));a=e.find("input");this.widthInput=a.eq(0);this.heightInput=a.eq(1);this.colorPicker.onSubmit=function(a){var c=b.getColor();Firefly.HistoryManager.addPropertiesEditAction(c,a,function(a){b.setColor(a);b.colorPicker.setColor(a)})};this.widthInput.change(function(){var a=b.getWidth(),c=b.widthInput.val();Firefly.HistoryManager.addPropertiesEditAction(a,c,function(a){b.setWidth(a);b.widthInput.val(a)})});this.heightInput.change(function(){var a=b.getHeight(),c=b.heightInput.val();
Firefly.HistoryManager.addPropertiesEditAction(a,c,function(a){b.setHeight(a);b.heightInput.val(a)})})};this.update=function(){this.initComplete&&(this.widthInput.val(this.getWidth()),this.heightInput.val(this.getHeight()))};this.getWidth=function(){return a.view.outerWidth()};this.setWidth=function(b){b=parseInt(b);a.view.outerWidth(b);Firefly.editor.updateSize()};this.getHeight=function(){return a.view.outerHeight()};this.setHeight=function(b){b=parseInt(b);a.view.outerHeight(b);Firefly.editor.updateSize()};
this.getColor=function(){var b=a.view.css("background-color");return Firefly.Color.getCSSHexColor(b)};this.setColor=function(b){a.view.css("background-color",b)}};Firefly.ComponentBaseDescriptor=function(a){var b=this;this.title="\u57fa\u672c\u7ec4\u4ef6";this.initComplete=!1;this.init=function(a){this.createChildren(a);this.initComplete=!0;this.update()};this.createChildren=function(c){c.header.text(this.title);var e=c.form,d=Firefly.FormViewManager.createPositionView();d.appendTo(e);var f=Firefly.FormViewManager.createSizeView();f.appendTo(e);Firefly.FormViewManager.createHline().appendTo(e);var g=Firefly.FormViewManager.createCheckBoxView("\u81ea\u52a8\u5927\u5c0f");
g.appendTo(e);e=d.find("input");this.xInput=e.eq(0);this.yInput=e.eq(1);f=f.find("input");this.widthInput=f.eq(0);this.heightInput=f.eq(1);this.autoSizeCheckBox=g.find(".ui.checkbox").eq(0);a.lockWidth&&a.lockHeight&&g.addClass("disabled");this.xInput.change(function(){var a=b.getX(),c=b.xInput.val();Firefly.HistoryManager.addPropertiesEditAction(a,c,function(a){b.setX(a);b.xInput.val(a)})});this.yInput.change(function(){var a=b.getY(),c=b.yInput.val();Firefly.HistoryManager.addPropertiesEditAction(a,
c,function(a){b.setY(a);b.yInput.val(a)})});this.widthInput.change(function(){var a=b.getWidth(),c=b.widthInput.val();Firefly.HistoryManager.addPropertiesEditAction(a,c,function(a){b.setWidth(a);b.widthInput.val(a)})});this.heightInput.change(function(){var a=b.getHeight(),c=b.heightInput.val();Firefly.HistoryManager.addPropertiesEditAction(a,c,function(a){b.setHeight(a);b.heightInput.val(a)})});this.autoSizeCheckBox.checkbox({onChange:function(){var a=b.getAutoSize(),c=b.autoSizeCheckBox.checkbox("is checked");
Firefly.HistoryManager.addPropertiesEditAction(a,c,function(a){b.setAutoSize(a);b.autoSizeCheckBox.checkbox(a?"set checked":"set unchecked")})}});Firefly.FormViewManager.createHeaderView("\u53e0\u653e\u987a\u5e8f").appendTo(c.layoutPanel);g=Firefly.FormViewManager.createLayoutView();g.appendTo(c.layoutPanel);c=g.find("button");c.popup();c.each(function(a){$(this).click(function(){switch(a){case 0:b.goTopLayer();break;case 1:b.goBottomLayer();break;case 2:b.goUpLayer();break;case 3:b.goDownLayer()}})})};
this.update=function(){if(this.initComplete){this.xInput.val(this.getX());this.yInput.val(this.getY());this.widthInput.val(this.getWidth());this.heightInput.val(this.getHeight());var b=this.getAutoSize();this.autoSizeCheckBox.checkbox(b?"set checked":"set unchecked");this.widthInput.parent()[b?"addClass":"removeClass"]("disabled");this.heightInput.parent()[b?"addClass":"removeClass"]("disabled");a.lockWidth&&this.widthInput.parent().addClass("disabled");a.lockHeight&&this.heightInput.parent().addClass("disabled")}};
this.getX=function(){return a.view.position().left};this.setX=function(b){b=parseInt(b);a.moveTo(b);Firefly.editor.getEditorCanvas().scaleTool.update()};this.getY=function(){return a.view.position().top};this.setY=function(b){b=parseInt(b);a.moveTo(void 0,b);Firefly.editor.getEditorCanvas().scaleTool.update()};this.getWidth=function(){return a.view.outerWidth()};this.setWidth=function(b){b=parseInt(b);a.resizeTo(b);Firefly.editor.getEditorCanvas().scaleTool.update()};this.getHeight=function(){return a.view.outerHeight()};
this.setHeight=function(b){b=parseInt(b);a.resizeTo(void 0,b);Firefly.editor.getEditorCanvas().scaleTool.update()};this.getAutoSize=function(){return a.getAutoSize()};this.setAutoSize=function(b){a.setAutoSize(b);Firefly.editor.getEditorCanvas().scaleTool.update()};this.goTopLayer=function(){Firefly.HistoryManager.addMoveLayerAction(a,"top")};this.goBottomLayer=function(){Firefly.HistoryManager.addMoveLayerAction(a,"bottom")};this.goUpLayer=function(){Firefly.HistoryManager.addMoveLayerAction(a,"up")};
this.goDownLayer=function(){Firefly.HistoryManager.addMoveLayerAction(a,"down")}};Firefly.MultipleSelectDescriptor=function(){var a=this;this.title="\u9009\u62e9\u591a\u4e2a";this.initComplete=!1;this.init=function(a){this.createChildren(a);this.initComplete=!0;this.update()};this.createChildren=function(b){b.header.text(this.title);var c=b.form,e=Firefly.FormViewManager.createPositionView();e.appendTo(c);b=Firefly.FormViewManager.createSizeView();b.appendTo(c);c=e.find("input");this.xInput=c.eq(0);this.yInput=c.eq(1);b=b.find("input");this.widthInput=b.eq(0);this.heightInput=
b.eq(1);this.xInput.change(function(){var b=a.getX(),c=a.xInput.val();Firefly.HistoryManager.addPropertiesEditAction(b,c,function(b){a.setX(b);a.xInput.val(b)})});this.yInput.change(function(){var b=a.getY(),c=a.yInput.val();Firefly.HistoryManager.addPropertiesEditAction(b,c,function(b){a.setY(b);a.yInput.val(b)})});this.widthInput.change(function(){var b=a.getWidth(),c=a.widthInput.val();Firefly.HistoryManager.addPropertiesEditAction(b,c,function(b){a.setWidth(b);a.widthInput.val(b)})});this.heightInput.change(function(){var b=
a.getHeight(),c=a.heightInput.val();Firefly.HistoryManager.addPropertiesEditAction(b,c,function(b){a.setHeight(b);a.heightInput.val(b)})})};this.update=function(a){this.initComplete&&(this.xInput.val(a==void 0?this.getX():a.x),this.yInput.val(a==void 0?this.getY():a.y),this.widthInput.val(a==void 0?this.getWidth():a.width),this.heightInput.val(a==void 0?this.getHeight():a.height))};this.getX=function(){return Firefly.editor.getEditorCanvas().scaleTool.view.position().left};this.setX=function(a){a=
parseInt(a);Firefly.editor.getEditorCanvas().scaleTool.moveTo(a)};this.getY=function(){return Firefly.editor.getEditorCanvas().scaleTool.view.position().top};this.setY=function(a){a=parseInt(a);Firefly.editor.getEditorCanvas().scaleTool.moveTo(void 0,a)};this.getWidth=function(){return Firefly.editor.getEditorCanvas().scaleTool.box.outerWidth()};this.setWidth=function(a){var a=parseInt(a),c=Firefly.editor.getEditorCanvas().scaleTool;c.resizeTo(a);c.update()};this.getHeight=function(){return Firefly.editor.getEditorCanvas().scaleTool.box.outerHeight()};
this.setHeight=function(a){var a=parseInt(a),c=Firefly.editor.getEditorCanvas().scaleTool;c.resizeTo(void 0,a);c.update()}};Firefly.ImageDescriptor=function(a){var b=this;Firefly.ComponentBaseDescriptor.call(this,a);this.title="\u56fe\u7247";var c=this.createChildren;this.createChildren=function(a){c.call(this,a);this.scaleModeDropdown=new Firefly.Dropdown("\u7f29\u653e\u6a21\u5f0f",[{value:0,label:"\u62c9\u4f38"},{value:1,label:"\u5185\u9002\u5e94"},{value:2,label:"\u5916\u9002\u5e94"}]);this.scaleModeDropdown.view.appendTo(a.form);this.scaleModeDropdown.setValue(this.getScaleMode());this.scaleModeDropdown.onChange=function(a){var c=
b.getScaleMode();Firefly.HistoryManager.addPropertiesEditAction(c,a,function(a){b.setScaleMode(a);b.scaleModeDropdown.setValue(a)})}};this.getScaleMode=function(){return a.getScaleMode()};this.setScaleMode=function(b){a.setScaleMode(b)}};Firefly.FormViewManager={};Firefly.FormViewManager.createPositionView=function(){return $('<div class="inline fields">\t<div class="eight wide field">\t\t<label>X</label>\t\t<input type="text" placeholder="">   </div>   <div class="eight wide field">\t\t<label>Y</label>\t\t<input type="text" placeholder="">\t</div></div>')};Firefly.FormViewManager.createSizeView=function(){return $('<div class="inline fields">\t<div class="eight wide field">\t\t<label>\u5bbd</label>\t\t<input type="text" placeholder="">   </div>   <div class="eight wide field">\t\t<label>\u9ad8</label>\t\t<input type="text" placeholder="">\t</div></div>')};
Firefly.FormViewManager.createHline=function(){return $('<div class="ui divider"></div>')};Firefly.FormViewManager.createCheckBoxView=function(a){return $('<div class="inline fields">\t<div class="five wide field">\t\t<label>'+a+'</label>\t</div>\t<div class="eleven wide field">\t\t<div class="ui checkbox">\t\t\t<input type="checkbox">\t\t\t<label></label>\t\t</div>\t</div></div>')};
Firefly.FormViewManager.createDropdownView=function(a,b){for(var c=$('<div class="inline fields">\t<div class="five wide field">\t\t<label>'+a+'</label>\t</div>\t<div class="eleven wide field">\t\t<div class="ui selection dropdown">\t\t\t<i class="dropdown icon"></i>\t\t\t<div class="default text"></div>\t\t\t<div class="menu">\t\t\t</div>\t\t</div>\t</div></div>'),e=c.find(".menu"),d=b.length,f=0;f<d;f++)$('<div class="item" data-value="'+b[f].value+'">'+b[f].label+"</div>").appendTo(e);return c};
Firefly.FormViewManager.createHeaderView=function(a){return $('<div class="ui small header">'+a+"</div>")};Firefly.FormViewManager.createLayoutView=function(){return $('<div class="ui basic buttons">\t<button class="ui icon button" data-content="\u7f6e\u9876"><i class="arrow circle up icon"></i></button>\t<button class="ui icon button" data-content="\u7f6e\u5e95"><i class="arrow circle down icon"></i></button>\t<button class="ui icon button" data-content="\u4e0a\u79fb\u4e00\u5c42"><i class="arrow up icon"></i></button>\t<button class="ui icon button" data-content="\u4e0b\u79fb\u4e00\u5c42"><i class="arrow down icon"></i></button></div>')};
Firefly.FormViewManager.createColorPickerView=function(a){return $('<div class="inline fields">\t<div class="five wide field">\t\t<label>'+a+'</label>\t</div>\t<div class="eleven wide field">\t\t<div class="colorPicker">\t\t\t<div class="box"></div>\t\t</div>\t</div></div>')};Firefly.FormViewManager.createTextInputView=function(a){return $('<div class="inline fields">\t<div class="five wide field">\t\t<label>'+a+'</label>\t</div>\t<div class="eleven wide field">\t\t<input type="text" placeholder="">\t</div></div>')};
Firefly.FormViewManager.createTextInputWithRightLabelView=function(a,b){return $('<div class="inline fields">\t<div class="five wide field">\t\t<label>'+a+'</label>\t</div>\t<div class="eleven wide field">\t\t<div class="ui right labeled input">\t\t\t<input type="text" placeholder="">\t\t\t<div class="ui basic label">'+b+"</div>\t\t</div>\t</div></div>")};Firefly.FormViewManager.createTextAreaView=function(a){return $('<div class="field">\t<label>'+a+'</label>\t<textarea style="margin-top: 0px; margin-bottom: 0px; height: 148px;"></textarea></div>')};
Firefly.FormViewManager.createFontStyleView=function(a){return $('<div class="inline fields">\t<div class="five wide field">\t\t<label>'+a+'</label>\t</div>\t<div class="eleven wide field">\t\t<div class="ui icon basic buttons">\t\t\t<button class="ui button"><i class="bold icon"></i></button>\t\t\t<button class="ui button"><i class="italic icon"></i></button>\t\t\t<button class="ui button"><i class="underline icon"></i></button>\t\t\t<button class="ui button"><i class="strikethrough icon"></i></button>\t\t</div>\t</div></div>')};
Firefly.FormViewManager.createTextHAlignView=function(a){return $('<div class="inline fields">\t<div class="five wide field">\t\t<label>'+a+'</label>\t</div>\t<div class="eleven wide field">\t\t<div class="ui icon basic buttons">\t\t\t<button class="ui button"><i class="align left icon"></i></button>\t\t\t<button class="ui button"><i class="align center icon"></i></button>\t\t\t<button class="ui button"><i class="align right icon"></i></button>\t\t</div>\t</div></div>')};Firefly.Rect=function(a,b,c,e){this.x=a;this.y=b;this.width=c;this.height=e;this.contain=function(a){return a.x>=this.x&&a.x<=this.x+this.width&&a.y>=this.y&&a.y<=this.y+this.height}};Firefly.Rect.testRectCross=function(a,b){var c,e,d,f;c=a.x+a.width/2;e=a.y+a.height/2;d=b.x+b.width/2;f=b.y+b.height/2;return Math.abs(c-d)<=a.width/2+b.width/2&&Math.abs(e-f)<=a.height/2+b.height/2};Firefly.Point=function(a,b){this.x=a;this.y=b};Firefly.Color={};Firefly.Color.randomColor=function(){var a=Math.floor(Math.random()*16777215).toString(16);return a.length==6?"#"+a:Firefly.Color.randomColor()};Firefly.Color.getCSSHexColor=function(a){if(a.indexOf("rgb")>-1){var b=a,b=a.indexOf("rgba")>-1?b.substr(5,b.length-6):b.substr(4,b.length-5),a=b.split(","),a={r:parseInt(a[0]),g:parseInt(a[1]),b:parseInt(a[2])};return"#"+$.colpick.rgbToHex(a)}else return a};Firefly.ArrayUtil={};Firefly.ArrayUtil.equals=function(a,b){var c=!0;if(a.length!=b.length)c=!1;else for(var e=a.length,d=0;d<e;d++)if(a[d]!==b[d]){c=!1;break}return c};Firefly.MainLayout=function(a){function b(){e.outerWidth(k);f.outerWidth(o);var a=$(window).width()-k-o-g.outerWidth()-h.outerWidth();d.outerWidth(a);var b=$(window).height()-$("#topMenu").outerHeight();e.outerHeight(b);f.outerHeight(b);d.outerHeight(b);d.css("left",k+g.outerWidth());f.css("left",k+a+g.outerWidth()+h.outerWidth());g.outerHeight(b);h.outerHeight(b);g.css("left",k);h.css("left",k+a+g.outerWidth());a=b-c.view.find(".menu").outerHeight()-10;q.outerHeight(a);p.outerHeight(a-n.outerHeight());
s.outerHeight(a)}var c=this;this.view=$(a);var e=this.view.find("#leftBox"),d=this.view.find("#centerBox"),f=this.view.find("#rightBox"),a=this.view.find(".vDivide"),g=a.eq(0),h=a.eq(1),l=g.find(".handle"),m=h.find(".handle"),k=322,o=320;l.click(function(){k=k==322?0:322;b()});m.click(function(){o=o==320?0:320;b()});e.css("position","absolute");d.css("position","absolute");f.css("position","absolute");this.view.find(".menu .item").tab();this.view.find(".segment").css("overflow","auto");var q=this.view.find("#resourcePanel .segment");
q.css("padding",5);var p=this.view.find("#propertiesPanel .segment"),n=this.view.find("#propertiesPanel #header"),s=this.view.find("#historyPanel .segment");s.css("padding",5);$(window).resize(b);b();this.toggleLeft=function(){l.trigger("click")};this.toggleRight=function(){m.trigger("click")}};
